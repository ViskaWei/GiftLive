# ğŸƒ Simulator V2 - å¹¶å‘å®¹é‡å»ºæ¨¡
> **Name:** Concurrency Capacity Modeling  
> **ID:** `EXP-20260109-gift-allocation-15`  
> **Topic:** `gift_allocation` | **MVP:** MVP-4.2  
> **Author:** Viska Wei | **Date:** 2026-01-09 | **Status:** âœ…  

> ğŸ¯ **Target:** éªŒè¯å¹¶å‘å®¹é‡çº¦æŸèƒ½å¦äº§ç”Ÿå¯è§‚æµ‹çš„æ”¶ç›Šè¾¹é™…é€’å‡  
> ğŸš€ **Next:** Gate-4B PASS â†’ ç»§ç»­ MVP-4.3 (å¬å›-ç²¾æ’åˆ†å·¥)

## âš¡ æ ¸å¿ƒç»“è®ºé€Ÿè§ˆ

> **ä¸€å¥è¯**: å¹¶å‘å®¹é‡æœºåˆ¶æˆåŠŸå®ç°è¾¹é™…é€’å‡ï¼Œé«˜è´Ÿè½½æ—¶æ”¶ç›Š/ç”¨æˆ·ä¸‹é™24.4%ï¼Œæ‹¥æŒ¤ç‡è¾¾68%

| éªŒè¯é—®é¢˜ | ç»“æœ | ç»“è®º |
|---------|------|------|
| H4.2: å¹¶å‘å®¹é‡å½±å“æ”¶ç›Šè¾¹é™…ï¼Ÿ | âœ… 24.4% ä¸‹é™ | é«˜è´Ÿè½½æ—¶è¾¹é™…é€’å‡æ˜¾è‘— |
| æ‹¥æŒ¤æ•ˆåº”å¯è§‚æµ‹ï¼Ÿ | âœ… 68% æ‹¥æŒ¤ç‡ | å¤´éƒ¨ä¸»æ’­æ‹¥æŒ¤æ˜æ˜¾ |

| æŒ‡æ ‡ | å€¼ | å¯ç¤º |
|------|-----|------|
| Revenue/User ä¸‹é™ | 24.4% | é«˜å¹¶å‘æŸå®³è¾¹é™…æ”¶ç›Š |
| Overcrowd Rate @800 | 67.9% | ä½å®¹é‡è§¦å‘æ‹¥æŒ¤ |
| Revenue Diff | 2.2% | å®¹é‡çº¦æŸäº§ç”Ÿå¯æµ‹æ•ˆåº” |

| Type | Link |
|------|------|
| ğŸ§  Hub | `gift_allocation/gift_allocation_hub.md` Â§ H4.2 |
| ğŸ—ºï¸ Roadmap | `gift_allocation/gift_allocation_roadmap.md` Â§ MVP-4.2 |

---
# 1. ğŸ¯ ç›®æ ‡

**é—®é¢˜**: V1 æ¨¡æ‹Ÿå™¨æ— ä¸»æ’­æ‰¿è½½ä¸Šé™ï¼Œæ— æ³•å»ºæ¨¡"è¿‡åº¦é›†ä¸­å¯¼è‡´ä½“éªŒæŸä¼¤"

**éªŒè¯**: H4.2 - å¹¶å‘å®¹é‡å½±å“æ”¶ç›Šè¾¹é™…

| é¢„æœŸ | åˆ¤æ–­æ ‡å‡† |
|------|---------|
| æ”¶ç›Š/ç”¨æˆ·éšè´Ÿè½½ä¸‹é™ | >5% ä¸‹é™ â†’ Gate-4B é€šè¿‡ |
| æ‹¥æŒ¤ç‡æ˜¾è‘— | >20% â†’ ç»§ç»­ MVP-4.3 |

---

# 2. ğŸ¦¾ ç®—æ³•

## 2.1 å¹¶å‘å®¹é‡æ¨¡å‹

**æ ¸å¿ƒæœºåˆ¶**:
1. **ä¸»æ’­å®¹é‡åˆ†å±‚**: æŒ‰çƒ­åº¦åˆ†é…å®¹é‡
   - Top 10%: capacity = 15
   - Middle 50%: capacity = 8
   - Tail 40%: capacity = 3

2. **æ‹¥æŒ¤æƒ©ç½šå‡½æ•°**:
$$\text{penalty}(n, C) = \begin{cases} 1.0 & n \leq C \\ \frac{1}{1 + \alpha \cdot \frac{n-C}{C}} & n > C \end{cases}$$

å…¶ä¸­ $\alpha = 0.5$ ä¸ºæƒ©ç½šå¼ºåº¦ã€‚

3. **æ”¶ç›Šè°ƒæ•´**:
$$r_{us}^{adjusted} = r_{us}^{base} \times \text{penalty}(n_s, C_s)$$

---

# 3. ğŸ§ª å®éªŒè®¾è®¡

## 3.1 æ•°æ®ä¸é…ç½®

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|-----|------|
| n_streamers | 100 | ä¸»æ’­æ•°é‡ |
| n_users | 10000 | ç”¨æˆ·æ±  |
| amount_version | 3 (V2+) | ç¦»æ•£æ¡£ä½æ¨¡å‹ |
| capacity_top10 | 15 | å¤´éƒ¨å®¹é‡ |
| capacity_middle | 8 | ä¸­éƒ¨å®¹é‡ |
| capacity_tail | 3 | å°¾éƒ¨å®¹é‡ |
| crowding_penalty_alpha | 0.5 | æƒ©ç½šå¼ºåº¦ |

## 3.2 å®éªŒç»„

| å®éªŒ | å‚æ•° | è¯´æ˜ |
|------|------|------|
| Exp 1 | enable_capacity on/off | åŸºçº¿å¯¹æ¯” |
| Exp 2 | users_per_round: 50-800 | å¹¶å‘è´Ÿè½½æ‰«æ |
| Exp 3 | beta: 0.1-2.0 | æƒ©ç½šå¼ºåº¦æ‰«æ |
| Exp 4 | scale: 0.5-2.0 | å®¹é‡è§„æ¨¡æ‰«æ |

---

# 4. ğŸ“Š å®éªŒå›¾è¡¨

## 4.1 Revenue vs Concurrency
![Revenue vs Concurrency](../img/mvp42_revenue_vs_concurrency.png)

**è§‚å¯Ÿ**: æ€»æ”¶ç›Šéšå¹¶å‘å¢åŠ ï¼Œä½†å¢é•¿ç‡é€’å‡

## 4.2 Marginal Revenue
![Marginal Revenue](../img/mvp42_marginal_revenue.png)

**è§‚å¯Ÿ**: è¾¹é™…æ”¶ç›Šåœ¨é«˜è´Ÿè½½æ—¶æ³¢åŠ¨ï¼Œä½† revenue_per_user æŒç»­ä¸‹é™

## 4.3 Capacity Comparison
![Capacity Comparison](../img/mvp42_capacity_comparison.png)

**è§‚å¯Ÿ**: å¯ç”¨å®¹é‡çº¦æŸåæ”¶ç›Šé™ä½ 2.2%

## 4.4 Parameter Heatmap
![Param Heatmap](../img/mvp42_param_heatmap.png)

**è§‚å¯Ÿ**: æƒ©ç½šå¼ºåº¦(Î²)å¢åŠ  â†’ æ”¶ç›Šé™ä½ï¼›å®¹é‡è§„æ¨¡å¢åŠ  â†’ æ”¶ç›Šæé«˜

## 4.5 Streamer Revenue by Tier
![Tier Revenue](../img/mvp42_streamer_revenue_by_tier.png)

**è§‚å¯Ÿ**: å¤´éƒ¨ä¸»æ’­åœ¨é«˜å¹¶å‘æ—¶æ”¶ç›Šé¥±å’Œ

---

# 5. ğŸ’¡ å…³é”®æ´è§

## 5.1 å®è§‚æ´è§

| ID | æ´è§ | è¯æ® |
|----|------|------|
| I20 | å¹¶å‘å®¹é‡èƒ½æœ‰æ•ˆå»ºæ¨¡è¾¹é™…é€’å‡ | Revenue/User ä» 0.49 é™è‡³ 0.37 |
| I21 | ä½å®¹é‡è®¾ç½®å¿…è¦ä»¥è§¦å‘æ‹¥æŒ¤ | åŸ capacity=100 æ— æ•ˆ |

## 5.2 æ¨¡å‹å±‚æ´è§

- **å®¹é‡è®¾ç½®**: éœ€è¦æ ¹æ® users_per_round è°ƒæ•´ï¼Œä¿è¯ overcrowd_ratio > 10%
- **æƒ©ç½šå¼ºåº¦**: Î²=0.5 æ˜¯åˆç†é»˜è®¤å€¼ï¼ŒÎ²>1.0 å½±å“è¿‡å¤§

## 5.3 ç»†èŠ‚è§‚å¯Ÿ

| Concurrency | Revenue/User | Overcrowd % |
|-------------|--------------|-------------|
| 50 | 0.51 | 0.4% |
| 100 | 0.43 | 2.2% |
| 200 | 0.49 | 10.3% |
| 400 | 0.47 | 31.9% |
| 800 | 0.37 | 67.9% |

---

# 6. ğŸ“ ç»“è®º

## 6.1 æ ¸å¿ƒå‘ç°

1. âœ… **H4.2 éªŒè¯é€šè¿‡**: å¹¶å‘å®¹é‡ç¡®å®å½±å“æ”¶ç›Šè¾¹é™…
2. âœ… **è¾¹é™…é€’å‡å¯è§‚æµ‹**: é«˜è´Ÿè½½æ—¶ Revenue/User ä¸‹é™ 24.4%
3. âœ… **æ‹¥æŒ¤æ•ˆåº”æ˜¾è‘—**: 800 ç”¨æˆ·æ—¶ 68% äº¤äº’å¤„äºæ‹¥æŒ¤çŠ¶æ€

## 6.2 å…³é”®æ•°å­—é€ŸæŸ¥

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| Diminishing Effect | 24.4% |
| Overcrowd Rate @800 | 67.9% |
| Revenue Diff (cap on/off) | 2.2% |
| Best Î² | 0.5 |

## 6.3 è®¾è®¡å¯ç¤º

- **å®¹é‡å‚æ•°éœ€æ ¡å‡†**: éœ€æ ¹æ®å®é™…å¹¶å‘é‡è®¾ç½®ï¼Œå¤ªé«˜æ— æ•ˆ
- **æƒ©ç½šå‡½æ•°å¯è°ƒ**: Î±=0.5 æ˜¯è‰¯å¥½èµ·ç‚¹
- **ç­–ç•¥ä¼˜åŒ–ç©ºé—´**: å¯è®¾è®¡ capacity-aware allocation ç­–ç•¥

## 6.4 âš ï¸ è¸©å‘è®°å½•

| é—®é¢˜ | åŸå›  | è§£å†³ |
|------|------|------|
| åˆå§‹å®éªŒæ— æ•ˆæœ | capacity=100 å¤ªé«˜ | é™è‡³ 15/8/3 |
| è¾¹é™…ä¸å•è°ƒé€’å‡ | éšæœºæ€§ + éçº¿æ€§æ•ˆåº” | ç”¨ revenue_per_user ä»£æ›¿ |

---

# 7. ğŸ“ ä¸‹ä¸€æ­¥

| æ–¹å‘ | ä»»åŠ¡ | ä¼˜å…ˆçº§ |
|------|------|--------|
| Gate-4B PASS âœ… | ç»§ç»­ MVP-4.3 å¬å›-ç²¾æ’åˆ†å·¥ | ğŸ”´ |
| å¯é€‰ä¼˜åŒ– | Capacity-aware allocation ç­–ç•¥ | ğŸŸ¡ |
| ä»£ç å›ºåŒ– | å°† capacity å‚æ•°åŠ å…¥é»˜è®¤é…ç½® | ğŸŸ¢ |

---

# 8. ğŸ“ é™„å½•

## 8.1 æ•°å€¼ç»“æœè¡¨

### Concurrency Sweep
| users_per_round | Revenue Mean | Revenue/User | Overcrowd % |
|-----------------|--------------|--------------|-------------|
| 50 | 1274 | 0.51 | 0.4% |
| 100 | 2162 | 0.43 | 2.2% |
| 200 | 4913 | 0.49 | 10.3% |
| 400 | 9400 | 0.47 | 31.9% |
| 800 | 14859 | 0.37 | 67.9% |

### Beta Sweep (users=400)
| Beta | Revenue Mean | Gini |
|------|--------------|------|
| 0.1 | 9897 | 0.846 |
| 0.3 | 9618 | 0.847 |
| 0.5 | 9400 | 0.848 |
| 1.0 | 9007 | 0.850 |
| 2.0 | 8532 | 0.852 |

### Capacity Scale Sweep (users=400)
| Scale | Revenue Mean | Gini |
|-------|--------------|------|
| 0.5x | 7129 | 0.852 |
| 1.0x | 9400 | 0.848 |
| 2.0x | 10020 | 0.846 |

## 8.2 å®éªŒæ‰§è¡Œè®°å½•

```
å®éªŒæ—¶é—´: 2026-01-09
è¿è¡Œå‘½ä»¤: python scripts/run_simulator_experiments.py --mvp 4.2 --n_sim 30
è¿è¡Œæ—¶é•¿: ~2 min
Gate-4B: PASS
```

## 8.3 ç›¸å…³æ–‡ä»¶

| ç±»å‹ | è·¯å¾„ |
|------|------|
| ä»£ç  | `scripts/simulator/simulator.py` |
| å®éªŒ | `scripts/run_simulator_experiments.py` |
| ç»“æœ | `gift_allocation/results/concurrency_capacity_20260109.json` |
| å›¾è¡¨ | `gift_allocation/img/mvp42_*.png` |
