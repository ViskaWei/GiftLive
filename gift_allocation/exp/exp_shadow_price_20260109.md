# ğŸ“— å®éªŒæŠ¥å‘Šï¼šå½±å­ä»·æ ¼/ä¾›éœ€åŒ¹é…

> **Experiment ID:** `EXP-20260109-gift-allocation-16`  
> **MVP:** MVP-5.2  
> **Author:** Viska Wei  
> **Date:** 2026-01-09  
> **Status:** âœ… Completed  
> **Gate:** Gate-5B

---

## ğŸ”— ä¸Šæ¸¸è¿½æº¯

- **Coding Prompt**: `gift_allocation/prompts/coding_prompt_mvp52_shadow_price_20260109.md`
- **Hub**: `../gift_EVmodel_hub.md`
- **Roadmap**: `../gift_EVmodel_roadmap.md`

---

## âš¡ æ ¸å¿ƒç»“è®ºé€Ÿè§ˆ

### ä¸€å¥è¯æ€»ç»“

**âŒ Gate-5B FAIL**: å½±å­ä»·æ ¼æ¡†æ¶æœªèƒ½åŒæ—¶æ»¡è¶³æ”¶ç›Šæå‡(+5%)å’Œçº¦æŸæ»¡è¶³ç‡(>90%)ç›®æ ‡ã€‚æœ€ä½³Shadow Priceç­–ç•¥æ”¶ç›Šä»…æå‡+2.74%ï¼Œä¸”å®¹é‡çº¦æŸæ»¡è¶³ç‡ä»…82.8%ã€‚

### å‡è®¾éªŒè¯

| å‡è®¾ | ç»“æœ | å…³é”®æ•°å€¼ |
|------|------|----------|
| H5B-1: å½±å­ä»·æ ¼èƒ½ç»Ÿä¸€å¤„ç†å¤šçº¦æŸ | âš ï¸ éƒ¨åˆ†éªŒè¯ | æˆåŠŸå®ç°5ç§çº¦æŸçš„ç»Ÿä¸€æ¡†æ¶ |
| H5B-2: æ”¶ç›Š â‰¥ Greedy+5% | âŒ å¤±è´¥ | å®é™…: +2.74% (ç›®æ ‡: +5%) |
| H5B-3: çº¦æŸæ»¡è¶³ç‡ >90% | âŒ å¤±è´¥ | å®¹é‡: 82.8%, å†·å¯åŠ¨: 91.5% |

### å…³é”®æ•°å­—é€ŸæŸ¥

| æŒ‡æ ‡ | Greedy | Greedy+Rules | Shadow Price Core | Shadow Price All |
|------|--------|--------------|-------------------|------------------|
| Revenue | 248,708 | 259,542 | 252,937 | 255,516 |
| Î” vs Greedy | 0% | **+4.36%** | +1.70% | +2.74% |
| Cold Start Rate | 90.1% | **97.8%** | 92.0% | 91.5% |
| Capacity Satisfy | N/A | N/A | 83.4% | 82.8% |
| Gini | 0.520 | 0.528 | 0.528 | 0.534 |

---

## ğŸ¯ ç›®æ ‡

### å®éªŒç›®çš„
éªŒè¯Primal-Dualå½±å­ä»·æ ¼æ¡†æ¶èƒ½å¦ï¼š
1. ç»Ÿä¸€å¤„ç†å¤šç§çº¦æŸï¼ˆå®¹é‡ã€å†·å¯åŠ¨ã€å¤´éƒ¨å æ¯”ã€é²¸é±¼åˆ†æ•£ã€é¢‘æ§ï¼‰
2. é€šè¿‡å¯¹å¶å˜é‡è‡ªåŠ¨å­¦ä¹ çº¦æŸä»·å€¼
3. åœ¨æ»¡è¶³çº¦æŸçš„åŒæ—¶æå‡æ”¶ç›Š

### Gate-5B åˆ¤å®šæ ‡å‡†
- æ”¶ç›Š â‰¥ Greedy+5% **AND** çº¦æŸæ»¡è¶³ç‡ >90% â†’ PASS
- å¦åˆ™ â†’ FAIL

### é¢„æœŸç»“æœ
- è‹¥ PASS â†’ æ›¿æ¢Greedy+è§„åˆ™ä¸ºç»Ÿä¸€æ¡†æ¶
- è‹¥ FAIL â†’ ä¿ç•™Greedy+è½¯çº¦æŸæ–¹æ¡ˆ

---

## ğŸ§ª å®éªŒè®¾è®¡

### æ ¸å¿ƒå…¬å¼

**åˆ†é…å†³ç­–**:
$$s^* = \arg\max_s \left[ \widehat{EV}(u,s) - \sum_c \lambda_c \cdot \Delta g_c(u \to s) \right]$$

**å¯¹å¶å˜é‡æ›´æ–°**:
$$\lambda_c^{(t+1)} = \left[ \lambda_c^{(t)} + \eta \cdot (g_c^{(t)} - b_c) \right]_+$$

### çº¦æŸç±»å‹

| çº¦æŸ | æè¿° | Î»_init |
|------|------|--------|
| C1: Capacity | ä¸»æ’­å¹¶å‘å®¹é‡ä¸Šé™ | 0.1 |
| C2: Cold Start | æ–°ä¸»æ’­æœ€ä½æ›å…‰ä¿éšœ | 0.5 |
| C3: Head Cap | Top-10%æ”¶ç›Šå æ¯”ä¸Šé™(â‰¤50%) | 0.1 |
| C4: Whale Spread | æ¯ä¸»æ’­é²¸é±¼æ•°ä¸Šé™(â‰¤2) | 0.2 |
| C5: Frequency | ç”¨æˆ·-ä¸»æ’­é‡å¤æ›å…‰é™åˆ¶(â‰¤3) | 0.3 |

### å®éªŒé…ç½®

```yaml
simulation:
  n_users: 10000
  n_streamers: 500
  n_rounds: 50
  users_per_round: 200
  n_simulations: 50
  seed: 42

policies:
  - greedy (baseline)
  - greedy_with_rules (cold_start_bonus + freq_penalty)
  - shadow_price_core (capacity + cold_start + head_cap)
  - shadow_price_all (all 5 constraints)
```

---

## ğŸ“Š å®éªŒå›¾è¡¨

### Fig 1: Revenue Comparison

![Revenue Comparison](../img/mvp52_revenue_comparison.png)

**è§‚å¯Ÿ**:
- Greedy+Rules (+4.36%) è¡¨ç°ä¼˜äº Shadow Price All (+2.74%)
- Shadow Price æ¡†æ¶åœ¨æ”¶ç›Šä¸Šæœªèƒ½è¶…è¶Šç®€å•è§„åˆ™æ–¹æ¡ˆ
- ä¸¤ç§Shadow Priceç­–ç•¥æ”¶ç›Šå·®å¼‚ä¸å¤§ (1.0%)

### Fig 2: Constraint Satisfaction Heatmap

![Constraint Satisfaction](../img/mvp52_constraint_satisfaction.png)

**è§‚å¯Ÿ**:
- å†·å¯åŠ¨æˆåŠŸç‡ï¼šGreedy+Rulesæœ€é«˜(97.8%)ï¼ŒShadow Priceçº¦91-92%
- å®¹é‡æ»¡è¶³ç‡ï¼šShadow Priceç­–ç•¥çº¦82-83%ï¼Œæœªè¾¾90%ç›®æ ‡
- Top-10%å æ¯”ï¼šæ‰€æœ‰ç­–ç•¥è¡¨ç°ç›¸ä¼¼(42-45%)

### Fig 3: Lambda Convergence

![Lambda Convergence](../img/mvp52_lambda_convergence.png)

**è§‚å¯Ÿ**:
- Cold Start Î»: ä»0.5å¿«é€Ÿä¸Šæ¶¨è‡³1.25å¹¶ç¨³å®šæ”¶æ•›
- Head Cap Î»: ä»0.1é€æ­¥ä¸Šæ¶¨è‡³0.42å¹¶æ”¶æ•›
- Whale Spread Î»: æŒç»­ç¼“æ…¢ä¸Šæ¶¨è‡³0.55ï¼Œæ”¶æ•›æ€§è¾ƒå·®
- Capacity Î»: ä¿æŒ0.1ä¸å˜ï¼ˆçº¦æŸæœªè§¦å‘ï¼‰
- Frequency Î»: ç¼“æ…¢ä¸Šæ¶¨è‡³0.36

### Fig 4: Learning Rate Sensitivity

![LR Sensitivity](../img/mvp52_lr_sensitivity.png)

**è§‚å¯Ÿ**:
- æ”¶ç›ŠéšÎ·å¢å¤§è€Œç•¥å¾®ä¸Šå‡ (244k â†’ 249k)
- å†·å¯åŠ¨ç‡å¯¹Î·ä¸æ•æ„Ÿ (91-92%)
- ç¨³å®šæ€§éšÎ·å¢å¤§è€Œä¸‹é™ (0.009 â†’ 0.175)
- **æ¨è**: Î·=0.05 æ˜¯æ”¶ç›Šä¸ç¨³å®šæ€§çš„è¾ƒå¥½å¹³è¡¡ç‚¹

### Fig 5: Constraint Ablation

![Constraint Ablation](../img/mvp52_constraint_ablation.png)

**è§‚å¯Ÿ**:
- æ·»åŠ çº¦æŸæ™®éå¯¼è‡´æ”¶ç›Šä¸‹é™
- Capacity only: åŸºæœ¬ä¸GreedyæŒå¹³
- +Cold Start: -0.57%
- +Head Cap: -1.10%
- +Whale Spread / +Frequency: æ— é¢å¤–å½±å“
- **ç»“è®º**: å½“å‰çº¦æŸè®¾è®¡å­˜åœ¨æ”¶ç›ŠæŸå¤±ï¼Œéœ€è¦é‡æ–°æ ¡å‡†

### Fig 6: Pareto Frontier

![Pareto Frontier](../img/mvp52_pareto_frontier.png)

**è§‚å¯Ÿ**:
- Greedy+Rulesåœ¨å¸•ç´¯æ‰˜å‰æ²¿ä¸Šæœ€ä¼˜ï¼ˆé«˜æ”¶ç›Š + é«˜çº¦æŸæ»¡è¶³ï¼‰
- Shadow Price Allè™½æœ‰æ›´å¤šçº¦æŸï¼Œä½†æœªèƒ½åœ¨æ”¶ç›Š-çº¦æŸæƒè¡¡ä¸Šèƒœå‡º
- GreedyåŸºçº¿è™½æ”¶ç›Šä½ä½†Giniè¾ƒä½ï¼ˆæ›´å…¬å¹³ï¼‰

---

## ğŸ’¡ å…³é”®æ´è§

### å®è§‚å±‚

1. **ç®€å•è§„åˆ™ > å¤æ‚æ¡†æ¶**: Greedy+Rulesçš„ç®€å•å†·å¯åŠ¨bonus+é¢‘æ§æƒ©ç½šç­–ç•¥è¡¨ç°ä¼˜äºShadow Priceç»Ÿä¸€æ¡†æ¶
2. **çº¦æŸè¶Šå¤š â‰  è¶Šå¥½**: æ·»åŠ æ›´å¤šçº¦æŸå¯¼è‡´æ”¶ç›ŠæŒç»­ä¸‹é™ï¼Œä¸”é¢å¤–çº¦æŸï¼ˆwhale_spread, frequencyï¼‰è´¡çŒ®è¾¹é™…
3. **å®¹é‡çº¦æŸæœªè§¦å‘**: Î»_capacityä¿æŒåˆå§‹å€¼0.1ï¼Œè¯´æ˜å½“å‰æ¨¡æ‹Ÿä¸­å®¹é‡çº¦æŸä¸æ˜¯ç“¶é¢ˆ

### æ¨¡å‹å±‚

1. **å¯¹å¶å˜é‡æ”¶æ•›æ€§**: cold_startå’Œhead_capæ”¶æ•›è‰¯å¥½ï¼Œwhale_spreadæ”¶æ•›è¾ƒæ…¢
2. **å­¦ä¹ ç‡é€‰æ‹©**: Î·=0.05-0.1æ˜¯è¾ƒå¥½åŒºé—´ï¼Œè¿‡é«˜å¯¼è‡´ä¸ç¨³å®š
3. **çº¦æŸæƒ©ç½šè®¾è®¡**: å½“å‰æƒ©ç½šå‡½æ•°å¯èƒ½è¿‡äºaggressiveï¼Œå¯¼è‡´æ”¶ç›ŠæŸå¤±

### å®éªŒå±‚

1. **æ•°æ®è§„æ¨¡æ•ˆåº”**: 50æ¬¡æ¨¡æ‹Ÿçš„ç»Ÿè®¡ç½®ä¿¡åº¦è¶³å¤Ÿï¼Œæ ‡å‡†å·®åœ¨åˆç†èŒƒå›´
2. **æ¨¡æ‹Ÿå™¨æ ¡å‡†**: å†·å¯åŠ¨æˆåŠŸç‡æ™®éé«˜(90%+)å¯èƒ½ä¸çœŸå®åœºæ™¯æœ‰å·®è·

---

## ğŸ“ ç»“è®º

### Gate-5B åˆ¤å®š

**âŒ FAIL**

| åˆ¤å®šé¡¹ | è¦æ±‚ | å®é™… | ç»“æœ |
|--------|------|------|------|
| æ”¶ç›Šæå‡ | â‰¥ Greedy+5% | +2.74% | âŒ |
| å†·å¯åŠ¨æˆåŠŸç‡ | â‰¥ 30% | 91.5% | âœ… |
| å®¹é‡æ»¡è¶³ç‡ | â‰¥ 90% | 82.8% | âŒ |

### å†³ç­–å»ºè®®

**ä¿ç•™ Greedy+Rules æ–¹æ¡ˆ**ï¼Œæš‚ä¸é‡‡ç”¨Shadow Priceæ¡†æ¶ã€‚

åŸå› ï¼š
1. Greedy+Rulesåœ¨æ”¶ç›Šä¸Šæ›´ä¼˜ (+4.36% vs +2.74%)
2. Greedy+Rulesçš„å†·å¯åŠ¨æ•ˆæœæ›´å¥½ (97.8% vs 91.5%)
3. Shadow Priceæ¡†æ¶å¢åŠ äº†å¤æ‚åº¦ä½†æœªå¸¦æ¥æ˜æ˜¾æ”¶ç›Š

### è®¾è®¡å¯ç¤º

| ç¼–å· | è®¾è®¡å¯ç¤º | æ¥æº |
|------|---------|------|
| DG7-1 | ç®€å•è§„åˆ™åœ¨ç°é˜¶æ®µè¶³å¤Ÿæœ‰æ•ˆï¼Œå¤æ‚æ¡†æ¶éœ€è¦æ›´å¥½çš„çº¦æŸæ ¡å‡† | æ”¿ç­–å¯¹æ¯” |
| DG7-2 | å†·å¯åŠ¨bonus=0.5æ˜¯æœ‰æ•ˆå‚æ•°ï¼Œå·²åœ¨Greedy+Rulesä¸­éªŒè¯ | æ”¿ç­–å¯¹æ¯” |
| DG7-3 | å¯¹å¶å˜é‡æ›´æ–°å­¦ä¹ ç‡Î·=0.05æ˜¯ç¨³å®šæ€§ä¸æ”¶ç›Šçš„å¹³è¡¡ç‚¹ | LR Sweep |
| DG7-4 | Whale Spreadçº¦æŸæ”¶æ•›æ€§å·®ï¼Œå¯èƒ½éœ€è¦é‡æ–°è®¾è®¡æƒ©ç½šå‡½æ•° | Lambdaæ”¶æ•› |

### åç»­å»ºè®®

1. **çŸ­æœŸ**: ç»§ç»­ä½¿ç”¨Greedy+Rulesï¼Œç›‘æ§çº¿ä¸Šå†·å¯åŠ¨å’Œæ”¶ç›ŠæŒ‡æ ‡
2. **ä¸­æœŸ**: ä¼˜åŒ–Shadow Priceçš„çº¦æŸæƒ©ç½šå‡½æ•°è®¾è®¡ï¼Œå‡å°‘æ”¶ç›ŠæŸå¤±
3. **é•¿æœŸ**: è€ƒè™‘åœ¨çº¿å­¦ä¹ Î»å€¼ï¼Œé€‚åº”æµé‡åŠ¨æ€å˜åŒ–

---

## ğŸ“ é™„å½•

### A. æ•°å€¼ç»“æœè¡¨

#### A.1 Policy Comparison (n=50)

| Policy | Revenue (meanÂ±std) | Gini | Cold Start | Top-10 Share | Capacity Satisfy |
|--------|-------------------|------|------------|--------------|------------------|
| greedy | 248,708 Â± 22,991 | 0.520 | 90.1% | 42.7% | N/A |
| greedy_with_rules | 259,542 Â± 38,488 | 0.528 | 97.8% | 44.7% | N/A |
| shadow_price_core | 252,937 Â± 37,234 | 0.528 | 92.0% | 44.0% | 83.4% |
| shadow_price_all | 255,516 Â± 41,810 | 0.534 | 91.5% | 44.8% | 82.8% |

#### A.2 Learning Rate Sweep (n=30)

| Î· | Revenue | Cold Start | Capacity Satisfy | Î» Stability |
|---|---------|------------|------------------|-------------|
| 0.001 | 244,617 | 90.9% | 82.8% | 0.009 |
| 0.01 | 243,573 | 91.1% | 83.0% | 0.064 |
| 0.05 | 245,868 | 91.4% | 83.0% | 0.139 |
| 0.1 | 247,039 | 91.2% | 82.9% | 0.163 |
| 0.2 | 249,143 | 91.8% | 82.6% | 0.175 |

#### A.3 Final Lambda Values

| Constraint | Î»_init | Î»_final | Stability |
|------------|--------|---------|-----------|
| capacity | 0.10 | 0.10 | 0.0000 |
| cold_start | 0.50 | 1.25 | 0.0003 |
| head_cap | 0.10 | 0.42 | 0.0000 |
| whale_spread | 0.20 | 0.55 | 0.2335 |
| frequency | 0.30 | 0.36 | 0.0456 |

### B. ä»£ç æ–‡ä»¶

- **Shadow Price Allocator**: `scripts/simulator/policies_shadow_price.py`
- **Experiment Script**: `scripts/train_shadow_price.py`
- **Results JSON**: `../results/shadow_price_20260109.json`

### C. è¿è¡Œç¯å¢ƒ

```
Date: 2026-01-09
Runtime: ~57 minutes
Simulations: 50 + 30 + 30 + 10 = 120
Seed: 42
```
