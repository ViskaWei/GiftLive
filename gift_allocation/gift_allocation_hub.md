# 🧠 Gift Allocation Hub

> **Status:** ✅ Phase 0-3 完成 | **Data:** KuaiLive | **Date:** 2026-01-08

## 🔑 核心结论 (8条)

| # | 结论 | 证据 | 决策 |
|---|------|------|------|
| K1 | **直接回归优于两段式** | Top-1%: 54.5% vs 35.7% | 保留简单架构 |
| K2 | **延迟反馈不是问题** | 86.3%礼物立即发生 | 简单负例处理足够 |
| K3 | **凹收益分配无显著优势** | Δ=-1.17%, Gini改善-0.018 | 简化为Greedy |
| K4 | **软约束冷启动有效** | 收益+32%, 成功率+263% | 采用λ=0.5 |
| K5 | **多任务学习无优势** | Δ PR-AUC=-1.76pp | 保留单任务 |
| K6 | **Two-Stage适合精排** | gift子集Spearman=0.89 | 可用于召回-精排分工 |
| K7 | **交互历史是最强特征** | 重要性是第二名3倍 | 优先维护交互特征 |
| K8 | **SNIPS是最佳OPE方法** | RelErr<10% | 探索率≥0.3, 日志≥5000 |

## 🏗️ 推荐架构

| 层 | 方法 | 参数 | 性能 |
|----|------|------|------|
| **估计层** | Direct Regression (LightGBM) | log(1+Y) | Top-1%=54.5% |
| **分配层** | Greedy + 软约束冷启动 | λ=0.5, min_alloc=10 | 收益+32% |
| **评估层** | SNIPS OPE | ε≥0.3, N≥5000 | RelErr<10% |

## 📊 关键数字

| 类别 | 指标 | 值 |
|------|------|-----|
| **数据** | 打赏率 | 1.48% |
| | User Gini | 0.942 |
| | 矩阵密度 | 0.0064% |
| | 冷启动主播 | 92.2% |
| **预测** | Direct Top-1% | 54.5% |
| | Two-Stage Top-1% | 35.7% |
| | Two-Stage NDCG@100 | 0.359 (精排更优) |
| | Stage2 gift子集Spearman | 0.892 |
| **分配** | Greedy/Random收益比 | 2.94x |
| | 软约束收益提升 | +32% |
| | 软约束成功率提升 | +263% |
| **评估** | SNIPS RelErr (Softmax) | 0.57% |
| | SNIPS RelErr (Greedy) | 9.97% |

## 🌲 问题树 (已验证)

```
如何最大化直播打赏收益？
│
├── Q1: 估计层 ✅
│   ├── 两段式 vs 直接回归？ → 直接回归更优 (Δ=+18.8pp)
│   ├── 延迟反馈建模？ → 不需要 (86.3%立即发生)
│   ├── 多任务学习？ → 无优势 (Δ=-1.76pp)
│   └── Two-Stage何时有用？ → 精排场景 (Spearman=0.89)
│
├── Q2: 分配层 ✅
│   ├── 凹收益 vs 贪心？ → 贪心足够 (Δ=-1.17%)
│   └── 冷启动约束？ → 软约束有效 (+32%收益)
│
└── Q3: 评估层 ✅
    ├── OPE可用性？ → SNIPS可用 (RelErr<10%)
    └── Simulator校准？ → Gini误差<5%
```

## ✅ Gate 状态

| Gate | 状态 | 结论 |
|------|------|------|
| Gate-1 估计层 | ✅ 完成 | 直接回归胜出；延迟/多任务无效 |
| Gate-2 分配层 | ✅ 关闭 | Greedy + 软约束冷启动 |
| Gate-3 评估层 | ✅ 关闭 | SNIPS RelErr<10% |

## 📐 设计原则

| 原则 | 建议 | 证据 |
|------|------|------|
| 高稀疏场景优先直接回归 | ✅ 做 | MVP-1.1-fair |
| 极稀疏(<2%)场景慎用多任务 | ✅ 做 | MVP-1.3 |
| 模型对比需统一候选集 | ✅ 做 | MVP-1.1 |
| 金额回归用log(1+Y) | ✅ 做 | 文献共识 |
| 稀疏信号用PR-AUC | ✅ 做 | 文献共识 |

## 📋 实验完成度

| Phase | 完成 | MVP |
|-------|------|-----|
| Phase 0 | 3/3 | 0.1, 0.2, 0.3 |
| Phase 1 | 6/7 | 1.1, 1.1-fair, 1.2, 1.2-audit, 1.3, 1.4 |
| Phase 2 | 2/2 | 2.1, 2.2 |
| Phase 3 | 1/1 | 3.1 |
| **总计** | **12/13** | MVP-1.5 可选 |

## 🔗 导航

| 文件 | 用途 |
|------|------|
| [Roadmap](./gift_allocation_roadmap.md) | MVP规格、进度追踪 |
| [exp/](./exp/) | 12个实验报告 |
| [results/](./results/) | 数值结果JSON |
