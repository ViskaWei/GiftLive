# 🧠 KuaiLive Hub
> **ID:** EXP-20260109-kuailive-hub | **Status:** 🌱探索 → 🚀进入建模&分配阶段 |
> **Date:** 2026-01-09 | **Update:** 2026-01-18
> **Author:** Viska Wei

| # | 💡 共识（会改变决策） | 证据 | 决策（So what） |
|---|---|---|---|
| K1 | **动态候选集是直播推荐的核心差异** | 通过 room start/end 支持真实模拟 | 离线评估必须重建"当时在播候选集"，否则指标虚高 |
| K2 | **多行为序列支持 multi-behavior/multi-task** | click/comment/like/gift 严格时间顺序 | 用密集信号（观看/互动）扶起稀疏信号（打赏） |
| K3 | **负反馈数据支持 CTR / 跳过建模** | 记录"曝光但跳过"的房间 | 可做 CTR/停留预测，并作为打赏前置信号 |
| K4 | **主播侧极端长尾，冷启动是结构性问题** | 约 70% 主播交互数 < 5（论文） | 禁止 5-core 过滤作为默认；必须有冷启动/公平策略 |
| K5 | **重复消费 + 日周期是结构性现象** | 约 27.1% 用户与同一主播重复交互（论文） | time-aware / session 建模与周期特征必备 |
| K6 | **Room 作为 item 比 Streamer 难很多** | 论文 benchmark：Room-level 指标显著更差 | 研究需明确 item 定义；打赏分配优先以 streamer-level 抽象承接能力 |
| K7 | **打赏高度"即时"** | 90.36% 打赏发生在 session 前 10% 时间 | 重点优化"首 10%"窗口：排序、触发、引导 |
| K8 | **Session 粒度合理** | Session 转化率 1.57% 与 click-level 1.48% 接近 | 预测与分配的主粒度优先用 session-level |
| K9 | **样本内"用户级打赏率≈100%"不可外推** | EDA 里 gift_rate=1.0（user.csv 采样偏差） | 报告/图表默认用 per-click / per-session 口径；用户级仅作"样本内部"分析 |
| K10 | **延迟反馈不是主要矛盾（至少在当前数据设定）** | 延迟中位数=0s；Chapelle 加权 ECE 变差 | 不走复杂延迟校正路线；工程上用简单截断+回补即可 |

---

## 1) 🧭 现阶段信念（≤10条，"所以呢"）
- **信念1：先把"长期目标"写成可计算的目标函数** → 预测层只输出分数不够，必须给分配层提供"可组合的价值"。
- **信念2：打赏是"首屏/首段时间"决策** → 首 10% 时间窗口特征是收益的主杠杆（高优先级工程）。
- **信念3：付费高度专一** → 付费扩展性有限，不能指望"把大哥导流给陌生主播"立刻奏效；需要分层策略（保底 vs 探索）。
- **信念4：高观看低付费 + 高吸引低变现是增量来源** → 增量更可能来自"转化效率提升"，而不是"挪动头部存量"。
- **信念5：全局最优≠单点最优** → 需要凹收益/影子价格/约束（承接上限、频控、生态护栏）。

**👣 下一步最有价值（≤2条，直接可进 Roadmap Gate）**
- 🔴 **P0**：定义长期目标函数 + 统一离线评估协议（指标/窗口/候选集/分母全部冻结）
- 🔴 **P0**：做 session-level 预测基线（Direct regression / multi-task）+ 证明"首10%窗口特征"的增益
- 🟡 **P1**：做分配层原型（凹收益 + 影子价格 + 约束）并用 Simulator 验证收益/生态 trade-off

> **权威数字**：数据集规模：用户 23,772 | 主播 452,621 | 直播间 11,613,708 | 总交互 5,357,998 | click=4,909,515 | gift=72,646 | per-click gift_rate=1.48% | Session=4,293,908 | session CVR=1.57% | 90.36% gift在session前10% | User Gini≈0.942 ｜

| 模型/方法 | 指标值 | 配置 | 备注 |
|-----------|--------|------|------|
| 论文 benchmark | Room-level 明显更难 | Top-K/CTR 两任务 | 研发需区分 item 定义 |
| Direct Reg (估计层) | Top-1% capture 54.5% | session-level | 头部捕获更强 |
| Two-Stage (估计层) | NDCG@100 0.371 | session-level | 细排更强 |

---

## 2) 🌲 核心假设树
```
🌲 核心: KuaiLive 数据集如何支持直播推荐研究 → 打赏预测与分配优化
│
├── Q1: 数据集特性与优势
│   ├── Q1.1: 动态候选集如何支持真实模拟? → ✅ 通过 room start/end 重建候选集
│   ├── Q1.2: 多行为序列如何利用? → ✅ click/comment/like/gift 支持 multi-behavior
│   ├── Q1.3: 负反馈数据如何应用? → ✅ 支持 CTR 预测任务
│
├── Q2: 数据分布特征
│   ├── Q2.1: 打赏是"即时冲动"还是"随观看累积"? → ✅ **已验证** 90.36% 立即打赏，发生在 session 前 10% 时间内
│   ├── Q2.2: 主播侧长尾分布如何影响建模? → ✅ 70% 主播交互 < 5，冷启动严重
│   ├── Q2.3: 用户活跃度分布特征? → ✅ 43.8% 用户交互 < 50，昼夜节律明显
│   ├── Q2.4: 重复消费模式如何建模? → ✅ 27.1% 用户重复交互，呈现日周期
│   ├── Q2.5: 数据是否存在异常/作弊/污染? → ✅ **已验证** 数据健康评分 5.0/5.0
│
├── Q3: 建模任务设计
│   ├── Q3.1: Room-level vs Streamer-level 性能差异? → ✅ Room 更难（短生命周期、稀疏）
│   ├── Q3.2: Session 粒度是否合理? → ✅ Session 转化率 1.57% 与 click-level 1.48% 接近
│   ├── Q3.3: 多任务学习是否有优势? → 🔆 进行中
│   └── Q3.4: 延迟反馈是否需要特殊处理? → ❌ **已否定** 延迟中位数=0s，校正无益
│
└── Q4: 分配优化设计
    ├── Q4.1: 凹收益函数形状? → ⏳ 待验证（log / sqrt / saturation）
    ├── Q4.2: 主播承接上限/用户疲劳约束形式? → ⏳ 待验证
    └── Q4.3: 长期目标的可观测代理指标? → ⏳ 待验证

Legend: ✅ 已验证 | ❌ 已否定 | 🔆 进行中 | ⏳ 待验证 | 🗑️ 已关闭
```

---

## 3) 口径冻结（唯一权威）
### 3.1 论文 benchmark（用于对齐）
- **Top-K 推荐**：Recall@{5,10,20}, NDCG@{5,10,20}；leave-one-out + 负采样
- **CTR 预测**：正负样本混合，按时间戳 8:1:1 切分；指标 AUC / LogLoss

### 3.2 本项目（面向"打赏预测 + 分配优化"）
**核心粒度：Session-level**
- 标签：`is_gift`（session 内是否发生礼物），`gift_amount`（session 内总金额，log1p）
- 估计层指标：
  - Gift 发生：PR-AUC、ECE（校准）
  - 金额：MAE(log)、Spearman
  - EV 排序：Top-1% Capture、NDCG@K（两个都保留，避免"只看头部"或"只看细排"）
- 决策层指标（必须同时报告）：
  - Revenue（短期）
  - 用户侧代理：session_watch_time、复访（次日是否再出现）、跳出率
  - 生态：Streamer Gini/HHI、长尾覆盖率（曝光/收入）

> 规则：任何口径变更必须写入 §9 变更日志。

---

## 4) 当前答案 & 战略推荐（对齐问题树）
### 4.1 当前推荐路线
- **Route A：估计层（多目标/多任务）→ 分配层（凹收益+约束）→ 评估层（Simulator/OPE）**
- 理由：打赏极稀疏+重尾+高方差，必须把"预测准确"与"全局分配"拆开调试。

### 4.2 分支答案表（每行必须回答"所以呢"）
| 分支 | 当前答案（1句话） | 置信度 | 决策含义（So what） | 证据（exp/MVP） |
|---|---|---|---|---|
| A | 动态候选集是核心差异 | 🟢 | 离线评估必须重建候选集 | 论文描述 |
| B | 多行为序列支持 multi-behavior | 🟢 | 用密集信号扶起稀疏信号 | 论文描述 |
| C | 主播侧极端长尾 | 🟢 | 禁止 5-core 过滤，需冷启动策略 | 论文统计 |
| D | 打赏即时性 | 🟢 | 首10%窗口是主杠杆 | EDA: 90.36% |
| E | Session 粒度合理 | 🟢 | 预测与决策粒度对齐 | EDA: CVR 1.57% |
| F | 延迟校正无益 | 🟢 | 关闭复杂延迟建模 | EDA: 延迟中位数=0s |

---

## 5) 洞见汇合（只收录"会改变决策"的）
| # | 洞见 | 证据 | 决策影响 |
|---|---|---|---|
| I1 | 数据质量优秀，可直接建模 | 健康评分 5.0/5.0；异常 <0.01% | 把精力从"清洗"转到"任务定义/特征/评估闭环" |
| I2 | 打赏即时性极强 | 90.36% 在 session 前 10% | 特征工程与产品触发都围绕"首10%窗口" |
| I3 | Session 粒度合理 | session 转化 1.57% 接近 click-level 1.48% | 训练样本与在线决策单位对齐 |
| I4 | 高观看低付费人群存在 | 17.6% 用户（4,178） | 增量优先：对这类人群做策略/引导 |
| I5 | 高吸引低变现主播存在 | 18.2% 主播（82,540） | 增量优先：提升供给侧转化效率 |
| I6 | 付费高度专一 | gift loyalty P50=100% | 分配层要分层：保底满足偏好 + 受控探索 |
| I7 | Gift 极稀疏且重尾 | per-click 1.48%；P50=2, P99≈1488；User Gini≈0.94 | 目标变换(log1p)、负采样/加权、以及"尾部方差控制" |
| I8 | 延迟校正不带来收益 | 延迟中位数=0s；Chapelle ECE 变差 | 关闭复杂延迟建模，工程用"截断+回补" |

---

## 6) 决策空白（Decision Gaps）
| DG | 我们缺的答案 | 为什么重要（会改哪个决策） | 什么结果能关闭它 |
|---|---|---|---|
| DG1 | Room vs Streamer 的任务边界与优先级 | 决定 item 定义与策略落点 | 明确：预测/分配主要在 streamer-level，room 用作短期上下文 |
| DG2 | 多任务是否显著优于单任务 | 决定架构复杂度 | multi-task 在 Gift PR-AUC、EV@TopK、校准上稳定提升 |
| DG3 | "首10%窗口特征"的边际增益 | 决定工程优先级 | ablation 证明对 EV/转化的提升显著 |
| DG4 | 凹收益函数的形状（log / sqrt / saturation） | 决定分配层行为（分散力度） | 通过模拟/离线证明某一族函数更稳健 |
| DG5 | 主播承接上限/用户疲劳的有效约束形式 | 决定约束设计 | 找到"超过阈值 → 留存/满意下降"的证据，并能被约束缓解 |
| DG6 | 长期目标的可观测代理指标（留存/满意/生态） | 没指标就无法做长期优化 | 形成可计算的 proxy（次日复访、停留、Gini/覆盖）并可离线评估 |
| DG7 | "集中度阈值"是否存在（过度集中会伤害生态） | 决定公平护栏强度 | 观察到集中度与用户/生态指标的拐点关系 |

---

## 7) 设计原则（可复用规则）
### 7.1 已确认
| # | 原则 | 建议（做/不做） | 证据 |
|---|---|---|---|
| P1 | 预测与决策粒度对齐 | ✅ Session-level 作为主粒度 | session 转化率与 click-level 接近 |
| P2 | 首 10% 时间窗口优先 | ✅ 做：窗口特征/触发/排序都围绕它 | 90.36% 打赏发生在前 10% |
| P3 | 重尾金额处理 | ✅ 做：log(1+Y) / 分位数思路 | P99/P50 巨大，重尾 |
| P4 | 稀疏学习强调"负样本信息" | ✅ 做：高稀疏场景优先考虑直接回归/统一候选集对比 | 公平对比 Direct Reg Top-1% 54.5% vs Two-Stage 35.8% |
| P5 | 分配层必须是"全局目标 + 约束" | ✅ 做：凹收益/影子价格/承接上限/频控/生态护栏 | 目标不是"爆一个主播"，而是长期全局 |
| P6 | 动态候选集建模 | ✅ 做：在离线实验中重建"某一时刻哪些房间在播" | 论文核心特性 |
| P7 | 多行为序列利用 | ✅ 做：设计 multi-behavior 模型，利用 click/comment/like/gift 层次关系 | 论文数据组成 |
| P8 | 长尾分布处理 | ✅ 做：不能用 5-core 过滤，需设计冷启动策略 | 论文统计：70% 主播交互 < 5 |

### 7.2 待验证
| # | 原则 | 初步建议 | 需要验证 |
|---|---|---|---|
| P9 | 多任务学习显著提升 gift 预测与稳定性 | 优先把 click/watch/like/comment 加入任务头 | ablation + 指标提升 |
| P10 | 凹收益分配优于贪心 | 用影子价格 g'(V) 实时折扣头部 | simulator 对比 |
| P11 | 冷启动/公平约束能带来长期收益 | 对长尾主播设探索下限 | 生态指标+留存 proxy 改善 |

### 7.3 关键数字速查（只留会反复用到的）
| 指标 | 值 | 条件 | 来源 |
|---|---|---|---|
| click 数 | 4,909,515 | 21 天窗口 | 论文统计 |
| gift 数 | 72,646 | 21 天窗口 | 论文统计 |
| per-click gift_rate | 1.48% | - | 论文统计 |
| Session 总数 | 4,293,908 | 21 天窗口 | EDA |
| Session CVR | 1.57% | - | EDA |
| 立即打赏比例 | 90.36% | session 前 10% 时间内 | EDA |
| User Gini | ≈0.942 | - | EDA |
| Streamer Gini | ≈0.930 | - | EDA |
| Top 1% user share | ≈59.9% | - | EDA |
| 高观看低付费用户 | 17.6% (4,178) | - | EDA |
| 高吸引低变现主播 | 18.2% (82,540) | - | EDA |
| gift loyalty P50 | 100% | - | EDA |
| 长尾主播比例 | 70% | 交互数 < 5 | 论文统计 |
| 数据健康评分 | 5.0/5.0 | - | EDA |

### 7.4 已关闭方向（避免重复踩坑）
| 方向 | 否定证据 | 关闭原因 |
|---|---|---|
| 延迟反馈复杂校正（Chapelle/生存加权） | 延迟中位数=0s；加权 ECE 变差 | 主要问题不在延迟，而在稀疏/重尾/分配 |

---

## 8) 模型/方法结果看板（只留"会影响下一步选择"的）
| 项 | 结论 | 指标（代表） | 启示 |
|---|---|---|---|
| 论文 benchmark | Room-level 明显更难 | Top-K/CTR 两任务均体现差异 | 研发需区分 item 定义 |
| 公平对比（估计层） | Direct Reg 在 Top-1% capture 更强；Two-Stage 在 NDCG@100 更强 | Top-1%：54.5% vs 35.8%；NDCG@100：0.217 vs 0.371 | 目标不同会选不同模型：头部捕获 vs 细排 |
| 延迟建模（估计层） | 延迟校正无益 | 延迟中位数=0s；ECE 变差 | 关闭该方向 |

---

## 9) 指针（详细信息在哪）
| 类型 | 路径 | 说明 |
|---|---|---|
| 🧠 Hub（当前） | `./kuailive_hub.md` | 统一共识、口径、决策空白 |
| 🗺️ Roadmap | `./kuailive_roadmap.md` | Decision Gates + MVP 执行 |
| 📊 EDA（基础） | `exp/exp_kuailive_eda_20260108.md` | gift 重尾/集中/稀疏 |
| 📊 EDA（全方位） | `exp/exp_kuailive_eda_comprehensive_20260109.md` | session/funnel/象限/专一/异常 |
| 📄 Paper | `kuailive.pdf` | 官方 benchmark 与设定 |

---

## 10) 变更日志（只记录"知识改变"）
| 日期 | 变更 | 影响 |
|---|---|---|
| 2026-01-09 | 创建 Hub，整理论文数据特性总结 | 建立 KuaiLive 数据集知识库 |
| 2026-01-09 | 添加 EDA 实验报告（exp_kuailive_eda_20260108.md） | 验证 Gift 行为稀疏性（1.48%）和重尾分布（Gini=0.94） |
| 2026-01-17 | Comprehensive EDA 完成：90.36% 即时打赏、session CVR=1.57%、17.6% 高观看低付费、18.2% 高吸引低变现、gift loyalty P50=100% | 进入"建模 + 分配"阶段：围绕首10%窗口与转化效率 |
| 2026-01-18 | 补充口径陷阱/样本偏差；加入长期目标与分配层决策空白；关闭延迟校正方向；合并核心假设树 | 报告可对外、决策更稳健 |

---

## 1.5) 口径陷阱与样本偏差（必读）
1) **用户采样偏差**
- KuaiLive 论文的用户采样是"活跃用户集合"，因此样本内很多"用户级是否打赏"指标会被抬高。
- 本项目默认口径：**per-click**（gift_count/click_count）或 **per-session**（gift_session/session）。

2) **全交互口径 vs gift 口径**
- 论文里很多结论基于"全交互（click/comment/like/gift）"；
- 本项目若讨论 gift，需要明确"仅 gift"或"全交互"。

3) **时间戳隐私处理**
- 若出现大量 0 秒延迟或时间离散点，需要同时考虑"用户行为机制"与"时间处理粒度"两种可能来源。

---

<details>
<summary><b>附录：术语表 / 背景（可选）</b></summary>

### 术语表
| 术语 | 定义 |
|---|---|
| **KuaiLive** | 快手（Kuaishou）首个公开"实时 + 可交互"直播推荐数据集 |
| **动态候选集** | 某一时刻哪些房间在播，候选集随时间动态变化 |
| **Room-level** | 以直播间（room）为推荐 item |
| **Streamer-level** | 以主播（streamer）为推荐 item |
| **Multi-behavior** | 多行为建模，利用 click/comment/like/gift 等多种行为 |
| **Time-aware** | 时间感知建模，考虑时间序列和周期性模式 |
| **重复消费** | 用户与同一主播多次交互的现象 |
| **5-core** | 数据过滤方法，要求每个节点至少有 5 条边 |
| **凹收益函数** | 边际收益递减的函数形式（如 log, sqrt），用于分散分配 |
| **影子价格** | 约束条件的边际价值，用于动态调整分配策略 |

### 背景
- **数据集来源**：快手（Kuaishou）直播平台
- **时间范围**：2025-05-05 到 2025-05-25（共 21 天）
- **数据特点**：
  - 带直播间生命周期（开播/下播）
  - 多种实时互动行为（click/comment/like/gift）
  - 用户/主播/房间侧信息
  - 严格的时间顺序日志
  - 有负反馈（曝光但跳过）
- **相比其他数据集优势**：
  - 支持动态候选集模拟
  - 多行为序列
  - 严格时间顺序
  - 负反馈数据
  - 丰富的侧信息特征

### 论文 Benchmark 任务
1. **Top-K 推荐**（两种 item 定义：推荐主播 vs 推荐直播间）
2. **CTR 预测**（含正负样本的时间切分 8:1:1）

### 支持的研究方向
- Top-K 推荐
- CTR / GTR（打赏转化）预测
- 观看时长预测
- 礼物价格预测
- 多行为建模 / 多任务学习
- 可控多目标推荐
- 冷启动推荐
- 公平性推荐
- 端到端生成式推荐

</details>
