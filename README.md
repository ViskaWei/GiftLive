# ğŸ GiftLive â€” ç›´æ’­æ‰“èµç¨€ç–ä¿¡å·å»ºæ¨¡ + åœ¨çº¿åˆ†é…

> **å±•ç¤ºå‹ä»“åº“** | é¢å‘ï¼šä¸»ç®¡/å·¥ä½œæ±‡æŠ¥ | ç›®æ ‡ï¼šæœ€å¤§åŒ–å…¨å±€é•¿æœŸæ”¶ç›Šå¹¶ä¿æŠ¤ç”Ÿæ€

---

## ğŸ“Œ é—®é¢˜å®šä¹‰ï¼ˆæ ¸å¿ƒï¼‰

**ç›®æ ‡**ï¼šä¸æ˜¯"è®©æŸä¸ªä¸»æ’­çˆ†"ï¼Œè€Œæ˜¯æœ€å¤§åŒ–å…¨å±€é•¿æœŸæ”¶ç›Š
- Total Revenue + ç”¨æˆ·ç•™å­˜/æ»¡æ„åº¦ + ä¸»æ’­ç”Ÿæ€å¥åº·

**éš¾ç‚¹**ï¼š
1. **ç¨€ç–+é‡å°¾**ï¼šæ‰“èµç‡ < 2%ï¼Œå°‘æ•°"å¤§å“¥"è´¡çŒ® 60% æ”¶ç›Šï¼ˆUser Gini = 0.94ï¼‰
2. **å»¶è¿Ÿåé¦ˆ**ï¼šè¿›æˆ¿åå¾ˆä¹…æ‰æ‰“èµï¼Œå¤šæ¬¡æ‰“èµï¼›ç®€å•æˆªæ–­ä¼šç³»ç»Ÿæ€§ä½ä¼°
3. **èµ„æºçº¦æŸ**ï¼šå¤§é¢ç”¨æˆ·æ˜¯ç¨€ç¼ºèµ„æºï¼Œä¸»æ’­æœ‰æ‰¿æ¥ä¸Šé™ï¼Œè¿‡åº¦é›†ä¸­ä¼¤ç”Ÿæ€/ä½“éªŒ

**å½¢å¼åŒ–**ï¼š
- **è¾“å…¥**ï¼šç”¨æˆ· Ã— ç›´æ’­é—´ Ã— ä¸Šä¸‹æ–‡ï¼ˆè¿›æˆ¿ã€åœç•™ã€äº’åŠ¨ã€å†å²ä»˜è´¹ï¼‰+ æ—¶é—´æˆ³
- **è¾“å‡º**ï¼šå¯¹"ç»™è°çœ‹ä»€ä¹ˆæˆ¿é—´"çš„åœ¨çº¿åˆ†é…ç­–ç•¥
- **çº¦æŸ**ï¼šå¤§é¢ç”¨æˆ·ç¨€ç¼ºï¼›ä¸»æ’­æ‰¿æ¥ä¸Šé™ï¼›ç”Ÿæ€å¹³è¡¡

---

## ğŸ”‘ ç»“è®ºå…ˆè¡Œï¼ˆå·²éªŒè¯å…±è¯†ï¼‰

| # | å…±è¯† | è¯æ® | å†³ç­– |
|---|------|------|------|
| K1 | âŒ ~~ä¸¤æ®µå¼ä¼˜äºç›´æ¥å›å½’~~ â†’ **å…¬å¹³å¯¹æ¯”ä¸‹ç›´æ¥å›å½’æ›´ä¼˜** | Direct Top-1% = 54.5% vs Two-Stage = 35.8% | ä¿ç•™ç®€å•æ¶æ„ï¼Œä¼˜åŒ–ç‰¹å¾ |
| K2 | äº¤äº’å†å²ç‰¹å¾ä¸»å¯¼é¢„æµ‹ï¼ˆ`pair_gift_mean` é‡è¦æ€§æ˜¯ç¬¬äºŒåçš„ 3Ã—ï¼‰ | Baseline Top-1% = 56.2% | ä¼˜å…ˆç»´æŠ¤äº¤äº’ç‰¹å¾ |
| K3 | é«˜ç¨€ç–åœºæ™¯ï¼ˆ98% Y=0ï¼‰ä¸‹ï¼Œç›´æ¥å›å½’å­¦ä¼šäº†"è°ä¸é€ç¤¼" | å¤§é‡è´Ÿæ ·æœ¬æœ‰ä¿¡æ¯ä»·å€¼ | æ•°æ®ç¨€ç–æ€§å½±å“æ¨¡å‹é€‰æ‹© |
| K4 | å»¶è¿Ÿåé¦ˆä¸èƒ½ç®€å•å½“è´Ÿä¾‹ï¼Œä¼šç³»ç»Ÿæ€§ä½ä¼° | æ–‡çŒ®å…±è¯† | éœ€ç”¨ç”Ÿå­˜åˆ†ææˆ–å»¶è¿Ÿæ ¡æ­£ |

---

## ğŸ“Š å…³é”®æ•°å­—

| æŒ‡æ ‡ | å€¼ | è¯´æ˜ |
|------|-----|------|
| æ‰“èµç‡ (per-click) | 1.48% | 72,646 / 4,909,515 |
| é‡‘é¢ P50 / P90 / P99 | 2 / 88 / 1,488 | æç«¯é‡å°¾ |
| User Gini | 0.942 | Top 1% ç”¨æˆ·è´¡çŒ® 59.9% æ”¶ç›Š |
| Streamer Gini | 0.930 | Top 1% ä¸»æ’­è´¡çŒ® 53.4% æ”¶ç›Š |
| Matrix Density | 0.0064% | ç”¨æˆ·-ä¸»æ’­äº¤äº’æç¨€ç– |
| Cold Start Streamer | 92.2% | æ— æ‰“èµä¸»æ’­å æ¯” |

---

## ğŸ§ª æ ¸å¿ƒæ–¹æ³•

**ä¸‰å±‚æ¶æ„**ï¼ˆåˆ†å±‚å»ºæ¨¡ Route B æ¨èï¼‰ï¼š

### 1ï¸âƒ£ ä¼°è®¡å±‚ï¼šæ‰“èµé¢„æµ‹
| æ–¹æ³• | æ¨¡å‹ | æŒ‡æ ‡ |
|------|------|------|
| **æ‰“èµå€¾å‘** | $P(\text{gift} \mid u, s, ctx)$ï¼Œç¨€ç–åœºæ™¯ç”¨ PR-AUC + æ ¡å‡† | PR-AUC = 0.65, ECE = 0.018 |
| **é‡‘é¢å»ºæ¨¡** | $\mathbb{E}[\text{amount} \mid \text{gift}, â€¦]$ï¼Œlog(1+Y) å›å½’ | MAE(log) = 0.263 |
| **æœŸæœ›æ”¶ç›Š** | $EV = P(\text{gift}) \times \mathbb{E}[\text{amount} \mid \text{gift}]$ | Top-1% Capture = 54.5% |

### 2ï¸âƒ£ å†³ç­–å±‚ï¼šåœ¨çº¿åˆ†é…
| é˜¶æ®µ | æ–¹æ³• | å¤æ‚åº¦ |
|------|------|--------|
| çº¦æŸæ’åº | åœ¨ EV æ’åºä¸ŠåŠ ã€Œå•ä¸»æ’­æ›å…‰ä¸Šé™/é¢‘æ§/é•¿å°¾ä¿éšœã€ | â­ æœ€æ˜“è½åœ° |
| æ¢ç´¢ç­–ç•¥ | çº¦æŸä¸‹ Contextual Banditï¼ˆÎµ-greedy / Thompsonï¼‰ | â­â­ |
| å‡¹æ”¶ç›Šåˆ†é… | æœ€å¤§åŒ– $\sum_s g_s(V_s)$ï¼Œè¾¹é™…é€’å‡ $\Delta(u \to s) \approx g'_s(V_s) \cdot v_{u,s}$ | â­â­â­ |

### 3ï¸âƒ£ è¯„ä¼°å±‚ï¼šç¦»çº¿+åœ¨çº¿
| ç±»å‹ | æŒ‡æ ‡ |
|------|------|
| ç¦»çº¿ | PR-AUC, ECE, Top-K Capture, Tail æŒ‡æ ‡ (Top 1%/0.1%), Ablation |
| åœ¨çº¿ | Revenue/DAU, ARPPU, ä»˜è´¹è½¬åŒ–ï¼›æŠ¤æ ï¼šD1/D7 ç•™å­˜, é€€å‡ºç‡/æŠ•è¯‰, Gini |

---

## ğŸ“ˆ æ¨¡å‹å¯¹æ¯”ç»“æœ

| æ¨¡å‹ | Top-1% | Spearman | NDCG@100 | å¤‡æ³¨ |
|------|--------|----------|----------|------|
| **Direct Reg (clickå…¨é‡)** | **54.5%** | 0.331 | 0.217 | âœ… **èƒœå‡º** |
| Two-Stage (clickå…¨é‡) | 35.8% | - | 0.359 | pÃ—m ä¹˜æ³•å¼•å…¥å™ªå£° |
| Baseline (gift-only) | 56.2% | 0.891 | 0.716 | å€™é€‰é›†ä¸åŒï¼Œä¸å¯ç›´æ¥å¯¹æ¯” |
| äºŒåˆ†ç±»ä¸Šé™ (Y>0) | 51.7% | - | - | ç†è®ºä¸Šé™ |

> **ç»“è®º**ï¼šå…¬å¹³å¯¹æ¯”ä¸‹ Direct Reg èƒœå‡º (Î” = +18.7pp)ï¼Œä¸¤æ®µå¼æ— ä¼˜åŠ¿ã€‚

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
GiftLive/
â”œâ”€â”€ gift_allocation/           # ğŸ“— ä¸»å®éªŒç›®å½•
â”‚   â”œâ”€â”€ gift_allocation_hub.md         # æ™ºåº“å¯¼èˆªï¼ˆé—®é¢˜æ ‘ã€å‡è®¾ã€æ´è§ï¼‰
â”‚   â”œâ”€â”€ gift_allocation_roadmap.md     # å®éªŒè¿½è¸ªï¼ˆMVPã€è¿›åº¦ã€æ•°å€¼ï¼‰
â”‚   â”œâ”€â”€ exp/                           # å­å®éªŒæŠ¥å‘Š
â”‚   â”œâ”€â”€ models/                        # æ¨¡å‹æ–‡ä»¶
â”‚   â”œâ”€â”€ results/                       # ç»“æœ JSON
â”‚   â”œâ”€â”€ prompts/                       # Coding Prompt
â”‚   â””â”€â”€ img/                           # å›¾è¡¨
â”œâ”€â”€ scripts/                   # ğŸ”§ è®­ç»ƒ/åˆ†æè„šæœ¬
â”œâ”€â”€ status/                    # ğŸ“‹ çŠ¶æ€è¿½è¸ª
â”œâ”€â”€ design/                    # ğŸ“ è®¾è®¡åŸåˆ™
â””â”€â”€ _backend/template/         # æ¨¡æ¿æ–‡ä»¶
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
# 1. ç¯å¢ƒåˆå§‹åŒ–
source init.sh

# 2. è¿è¡Œè®­ç»ƒï¼ˆç¤ºä¾‹ï¼‰
nohup python scripts/train_baseline_lgb.py > logs/baseline.log 2>&1 &

# 3. æŸ¥çœ‹æ—¥å¿—
tail -f logs/baseline.log
```

---

## ğŸ“‹ å®éªŒç´¢å¼•

| MVP | åç§° | çŠ¶æ€ | æŠ¥å‘Š |
|-----|------|------|------|
| 0.1 | KuaiLive æ•°æ®æ¢ç´¢ | âœ… | [exp_kuailive_eda_20260108.md](gift_allocation/exp/exp_kuailive_eda_20260108.md) |
| 0.2 | Baseline ç›´æ¥å›å½’ | âœ… | [exp_baseline_20260108.md](gift_allocation/exp/exp_baseline_20260108.md) |
| 1.1 | ä¸¤æ®µå¼å»ºæ¨¡ | âœ… | [exp_two_stage_20260108.md](gift_allocation/exp/exp_two_stage_20260108.md) |
| 1.1-fair | ä¸¤æ®µå¼å…¬å¹³å¯¹æ¯” | âœ… | [exp_fair_comparison_20260108.md](gift_allocation/exp/exp_fair_comparison_20260108.md) |
| 1.2 | å»¶è¿Ÿåé¦ˆå»ºæ¨¡ | ğŸ”´ | [exp_delay_modeling_20260108.md](gift_allocation/exp/exp_delay_modeling_20260108.md) |

---

## ğŸ”— å¯¼èˆª

| æ–‡æ¡£ | è·¯å¾„ | èŒè´£ |
|------|------|------|
| ğŸ§  Hub | [gift_allocation_hub.md](gift_allocation/gift_allocation_hub.md) | é—®é¢˜æ ‘ã€å‡è®¾ã€æˆ˜ç•¥å¯¼èˆª |
| ğŸ—ºï¸ Roadmap | [gift_allocation_roadmap.md](gift_allocation/gift_allocation_roadmap.md) | MVP è§„æ ¼ã€è¿›åº¦è¿½è¸ª |
| ğŸ“– å‘½ä»¤æ‰‹å†Œ | [COMMANDS.md](COMMANDS.md) | å¿«æ·å‘½ä»¤é€ŸæŸ¥ |

---

## ğŸ“š å‚è€ƒæ–‡çŒ®

| ä¸»é¢˜ | è®ºæ–‡ | è¦ç‚¹ |
|------|------|------|
| ç¨€ç–åˆ†ç±» | Focal Loss (Lin et al., 2017) | å¤„ç†æåº¦ä¸å‡è¡¡ |
| å»¶è¿Ÿåé¦ˆ | Delayed Conversion (Chapelle, 2014) | ç”Ÿå­˜åˆ†ææ€è·¯ |
| å‡¹æ”¶ç›Šåˆ†é… | Online Matching with Concave Returns (Devanur et al.) | è¾¹é™…é€’å‡åˆ†é… |
| OPE | Doubly Robust (DudÃ­k et al., 2011) | å‡å°æ–¹å·® |

---

## ğŸ“… æ›´æ–°æ—¥å¿—

| æ—¥æœŸ | äº‹ä»¶ |
|------|------|
| 2026-01-08 | MVP-1.1-fair å®Œæˆï¼šDirect Reg èƒœå‡º (Top-1% 54.5% vs 35.8%) |
| 2026-01-08 | MVP-1.1 å®Œæˆï¼šä¸¤æ®µå¼å»ºæ¨¡ï¼Œæ­ç¤ºä¸ Baseline ä¸å¯ç›´æ¥å¯¹æ¯” |
| 2026-01-08 | MVP-0.2 å®Œæˆï¼šBaseline LightGBM (Top-1% = 56.2%) |
| 2026-01-08 | MVP-0.1 å®Œæˆï¼šKuaiLive æ•°æ®æ¢ç´¢ (Gini = 0.94) |
| 2026-01-08 | é¡¹ç›®ç«‹é¡¹ |

---

**ä½œè€…**: Viska Wei | **åˆ›å»º**: 2026-01-08
