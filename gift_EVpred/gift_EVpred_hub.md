# ğŸ§  gift_EVpred Hub

> **Status:** âœ… æ”¶æ•›ï¼ˆBaseline v1.0ï¼‰ | **Layer:** ä¼°è®¡å±‚ | **Date:** 2026-01-19

---

## ğŸ”— ä¸Šæ¸¸é“¾æ¥

| å±‚ | é“¾æ¥ | å…³ç³» |
|----|------|------|
| **Main** | [main_hub.md](../main/main_hub.md) | å…¨å±€ç»¼åˆ |
| **Data** | [kuailive_hub.md](../KuaiLive/kuailive_hub.md) | æ•°æ®æ¥æº |
| **Allocation** | [gift_allocation_hub.md](../gift_allocation/gift_allocation_hub.md) | ä¸‹æ¸¸æ¶ˆè´¹è€… |

---

## ğŸ¯ æœ¬å±‚èŒè´£

> **ä¼°è®¡å±‚èŒè´£**ï¼šé¢„æµ‹æ¯æ¬¡ click çš„æ‰“èµæœŸæœ›å€¼ (EV)ï¼Œä¸ºåˆ†é…å±‚æä¾›æ’åºåˆ†æ•°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    gift_EVpred èŒè´£                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… åšï¼šEV é¢„æµ‹æ¨¡å‹ã€ç‰¹å¾å·¥ç¨‹ã€æ¨¡å‹å¯¹æ¯”ã€é¢„æµ‹è¯„ä¼°æŒ‡æ ‡         â”‚
â”‚ âŒ ä¸åšï¼šåˆ†é…ç­–ç•¥ã€Simulatorã€OPEã€æ•°æ® EDA                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

| # | ğŸ’¡ å…±è¯† | è¯æ® | å†³ç­– |
|---|--------|------|------|
| K1 | **æ’åº/åˆ†é… > é€æ¡é¢„æµ‹**ï¼šä¸éœ€è¦é¢„æµ‹å‡†æ¯ä¸€æ¡ï¼ŒæŠŠé«˜ä»·å€¼æ”¾å¯¹ä½ç½®å³å¯ | RevCap vs MAE | è¯„ä¼°ç”¨ RevCap@K |
| K2 | **Raw Y ä¼˜äº Log(1+Y)**ï¼šlog å˜æ¢å‹ç¼© whale ä¿¡å· | RevCap +39.6% | é¢„æµ‹ç›®æ ‡ç”¨ raw Y |
| K3 | **RevCap â‰  Spearman**ï¼šæ•´ä½“æ’åºä¸é‡è¦ï¼Œå¤´éƒ¨ç²¾å‡†æ›´é‡è¦ | è´Ÿç›¸å…³ | ç”¨ RevCap è¯„ä¼° |
| K4 | **å†å²æ‰“èµæ˜¯æœ€å¼ºä¿¡å·**ï¼špair-level å†å² > user/streamer å…¨å±€ | ç³»æ•° 0.194 | é‡ç‚¹æŒ–æ˜ pair ç‰¹å¾ |
| K5 | **æ—¶é—´çª—çºªå¾‹**ï¼šä»»ä½•ç‰¹å¾å¿…é¡»æ˜¯ t_click ä¹‹å‰å¯å¾— | 200/200 é€šè¿‡ | Day-Frozen / Rolling |
| K6 | **watch_live_time æ˜¯ post-treatment**ï¼šåŒ…å«æ‰“èµååœç•™ï¼Œclick æ—¶åˆ»ä¸å¯å¾— | å› æœåˆ†æ | åˆ é™¤å½“å‰ sessionï¼›å¯ç”¨å†å²å…ˆéªŒ |
| K7 | **å›å½’ > åˆ†ç±»ï¼ˆfor RevCapï¼‰**ï¼šåˆ†ç±»ä¸¢å¤±é‡‘é¢ä¿¡æ¯ï¼Œå›å½’ä¿ç•™"å¤§å“¥æœ‰å¤šå¤§" | AUCâ†‘ä½†RevCapâ†“ | RevCap ä»»åŠ¡ç”¨å›å½’ï¼Œä¸ç”¨åˆ†ç±» |
| K8 | **Linear > Treeï¼ˆé«˜ç¨€ç–å›å½’ï¼‰**ï¼š98.5% ä¸º 0 æ—¶ï¼Œæ ‘æ¨¡å‹é¢„æµ‹ä¼—æ•° | LGB -14.5% | ç¨€ç–å›å½’ç”¨ Linear |
| K9 | **âš ï¸ Cold Start æ•ˆåº”**ï¼šTrain RevCap << Test RevCap ä¸æ˜¯æ³„æ¼ï¼Œæ˜¯å†å²æ•°æ®ç§¯ç´¯ä¸è¶³ | Train é¦–æ—¥ 0.1% | è¯„ä¼°çœ‹ Testï¼ŒTrain ä»…ç”¨äºè®­ç»ƒ |
| K10 | **âœ… Last-Touch + gift_id å»é‡**ï¼šæ¯ä¸ª gift åªå½’å› æœ€è¿‘ 1 æ¡ clickï¼ŒæŒ‰ gift_id å»é‡é¿å…é‡å¤ | æ— è†¨èƒ€ | æ ‡å‡†å½’å› æ–¹æ¡ˆ |
| K11 | **âœ… 1 åˆ†é’Ÿçª—å£è¶³å¤Ÿ**ï¼š98.2% gift åœ¨ click åŒæ¯«ç§’å†…å‘ç”Ÿï¼Œ1min çª—å£è¦†ç›– 92.6% | Coverage åˆ†æ | é»˜è®¤ 1minï¼Œå‡å°‘å½’å› å™ªå£° |
| K12 | **âœ… Strict æ¨¡å¼æ— æ³„æ¼**ï¼šdrop å¿«ç…§ç‰¹å¾ï¼ˆfans/accu_*ï¼‰ï¼Œä»…ç”¨çœŸæ­£é™æ€+å†å²ç‰¹å¾ | KuaiLive å¿«ç…§æ˜¯ May 25 | é»˜è®¤ Strictï¼ŒBenchmark å¯é€‰ |
| K13 | **âš ï¸ é¦–æ¬¡æ‰“èµé¢„æµ‹å¼±**ï¼š56% æ”¶å…¥æ¥è‡ªæ— å†å² pairï¼Œä½† RevCap åªæœ‰ 29.6% | æ¨¡å‹ä¾èµ–å¤è´­ä¿¡å· | éœ€ä¼˜åŒ– user/str çº§ç‰¹å¾ |
| K14 | **âŒ ç•™å­˜ä¸å¯é¢„æµ‹**ï¼šAUC=0.57ï¼ˆæ¥è¿‘éšæœºï¼‰ï¼Œå½“å‰ç‰¹å¾æ— æ³•é¢„æµ‹æ¬¡æ—¥ç•™å­˜ | ç•™å­˜ç”±éšæ€§å› ç´ å†³å®š | æ”¾å¼ƒä½œä¸ºé¢„æµ‹ç›®æ ‡ |
| K15 | **ğŸ”¥ æ‰“èµæŸå®³ç•™å­˜**ï¼šæ‰“èµç”¨æˆ·ç•™å­˜ 78.9% vs æœªæ‰“èµ 89.2%ï¼ˆ-10.3ppï¼‰ | "æ»¡è¶³åç¦»å¼€"æ•ˆåº” | çŸ­æœŸæ”¶ç›Š â‰  é•¿æœŸä»·å€¼ |
| K16 | **âœ… æ”¶å…¥æåº¦é›†ä¸­**ï¼šGini=0.926ï¼ŒTop 1% ä¸»æ’­å  93.7% æ”¶å…¥ | å¤´éƒ¨å¸é‡‘æ•ˆåº” | åˆ†é…å±‚éœ€ç”Ÿæ€çº¦æŸ |
| K17 | **âœ… Sample vs User ç²’åº¦å·®å¼‚**ï¼šBaseWhaleRate 43Ã— å·®è·ï¼ˆ0.143% vs 6.21%ï¼‰ | äº‹ä»¶ç¨€ç–ï¼Œç”¨æˆ·ç²’åº¦å¤§å“¥æ¯”ä¾‹é«˜ | å¤šç²’åº¦è¯„ä¼°å¿…è¦ |
| K18 | **âœ… 7 å±‚ 38 æŒ‡æ ‡ä½“ç³»**ï¼šL1 ä¸»æŒ‡æ ‡ â†’ L7 å†³ç­–æ ¸å¿ƒï¼Œè¦†ç›– ML å…¨ç”Ÿå‘½å‘¨æœŸ | v2.2 å£å¾„è§„èŒƒ | æ‰€æœ‰å®éªŒå¿…é¡»ä½¿ç”¨ v2.2 |

**ğŸ¦¾ ç°é˜¶æ®µä¿¡å¿µ**
- **Direct + raw Y (Ridge) æ˜¯å½“å‰æœ€ä¼˜æ–¹æ¡ˆ** â†’ RevCap@1%=51.4%ï¼ˆStrict Modeï¼‰ï¼ŒCV=9.4%
- **LightGBM å›å½’å¤±è´¥ï¼Œåˆ†ç±»æˆåŠŸä½†æ— ç”¨** â†’ åˆ†ç±»ä¸¢å¤±é‡‘é¢ä¿¡æ¯ï¼ŒAUC é«˜ä¸ä»£è¡¨ RevCap é«˜
- **ç›®å‰ä¸“æ³¨"è¯†åˆ«å¤§å“¥"**ï¼Œæš‚ä¸è€ƒè™‘åˆ†é…ä¼˜åŒ– â†’ å…ˆåšå¥½ EV é¢„æµ‹è¿™ä¸ªåŸºç¡€æ¨¡å—
- **Frozen ç‰¹å¾å·²å¤Ÿç”¨**ï¼ŒRolling æ˜¯åç»­è¿­ä»£æ–¹å‘ â†’ å½“å‰ä¸å¢åŠ å¤æ‚åº¦
- **âœ… data_utils.py Final ç‰ˆæœ¬** â†’ Last-Touch + gift_id å»é‡ + 1min çª—å£ + Strict æ¨¡å¼

**ğŸ‘£ ä¸‹ä¸€æ­¥æœ€æœ‰ä»·å€¼**ï¼ˆ2026-01-19 æ›´æ–°ï¼‰

> ğŸ“¢ **æ¸…ç†å½’æ¡£**ï¼šæ—§å®éªŒï¼ˆä¸€ä¸ª gift å½’å› å¤šä¸ª clickï¼‰å·²ç§»è‡³ `archive_last_touch/`ï¼Œéœ€ç”¨æ­£ç¡®æ•°æ®é‡è·‘

| ä¼˜å…ˆçº§ | ä»»åŠ¡ | éªŒæ”¶æ ‡å‡† | çŠ¶æ€ |
|--------|------|----------|------|
| ğŸ”´ **P0** | **é‡è·‘ Two-Stage (Last-Touch æ•°æ®)** | RevCap å¯¹æ¯” | ğŸ”„ å¾…é‡åš |
| ğŸ”´ **P0** | **é‡è·‘ LightGBM (Last-Touch æ•°æ®)** | RevCap å¯¹æ¯” | ğŸ”„ å¾…é‡åš |
| ğŸŸ¡ P1 | Whale ä¸“å±ç‰¹å¾ | RevCap > 54% | å¾…ç«‹é¡¹ |
| ğŸŸ¢ P2 | å°è¯• MLP | RevCap > 55% | å¾…ç«‹é¡¹ |
| ğŸŸ¢ P3 | åˆ†é… MVP | è´ªå¿ƒ vs å‡¹æ”¶ç›Šè´ªå¿ƒ | å¾…ç«‹é¡¹ |

**è¯¦è§**: [å®éªŒæŠ¥å‘Š](./exp/)

---

## ğŸ“Š Final Baseline v1.0ï¼ˆ2026-01-19ï¼‰

> **æƒå¨æ•°å­—**ï¼šRevCap@1%=**51.4%**ï¼ˆStrict Mode, 1min Windowï¼‰ï¼›CV=**9.4%**ï¼ˆé¦–æ¬¡ <10%ï¼‰

### æ ¸å¿ƒç»“æœ

| æŒ‡æ ‡ | å€¼ | è¯´æ˜ |
|------|-----|------|
| **RevCap@1%** | **51.4%** | Top 1% é¢„æµ‹æ•è· 51.4% æ”¶å…¥ |
| **Normalized RevCap@1%** | **51.6%** | vs Oracle ä¸Šç•Œï¼ˆ99.5%ï¼‰ |
| **CV (ç¨³å®šæ€§)** | **9.4%** | é¦–æ¬¡ <10% é˜ˆå€¼ |
| **95% CI** | [47.2%, 54.4%] | Bootstrap ç½®ä¿¡åŒºé—´ |
| Whale Recall@1% | 34.6% | å¬å› 34.6% çš„å¤§é¢æ‰“èµ |
| Whale Precision@1% | 5.0% | Top 1% ä¸­ 5% æ˜¯å¤§é¢æ‰“èµ |
| Avg Revenue@1% | 78.2 å…ƒ | Top 1% äººå‡æ‰“èµé‡‘é¢ |
| Gift Rate@1% | ~35% | Top 1% ä¸­æœ‰æ‰“èµçš„æ¯”ä¾‹ |

### RevCap@K æ›²çº¿ï¼ˆRevShare@Kï¼‰

| Top K% | RevCap | Oracle | Normalized | Whale Recall |
|--------|--------|--------|------------|--------------|
| **0.1%** | **21.2%** | 83.9% | 25.3% | 9.9% |
| **0.5%** | **43.3%** | 98.3% | 44.1% | 26.6% |
| **1%** | **51.4%** | 99.5% | 51.6% | 34.6% |
| **2%** | **56.3%** | 100% | 56.3% | 42.1% |
| **5%** | **63.6%** | 100% | 63.6% | 52.7% |
| **10%** | **68.6%** | 100% | 68.6% | 61.7% |

> **è§£è¯»**ï¼š@2% æ—¶ Oracle å·²è¾¾ 100%ï¼Œè¯´æ˜å…¨éƒ¨æ”¶å…¥é›†ä¸­åœ¨ Top 2% æ ·æœ¬ä¸­

### ç”Ÿæ€æŒ‡æ ‡ï¼ˆåˆ†é…å±‚æŠ¤æ ï¼‰

| æŒ‡æ ‡ | å€¼ | è¯´æ˜ |
|------|-----|------|
| **Streamer Gini** | **0.926** | æ”¶å…¥æåº¦é›†ä¸­ |
| Top 1% ä¸»æ’­æ”¶å…¥å æ¯” | 93.7% | å¤´éƒ¨å¸é‡‘æ•ˆåº” |
| Top 10% ä¸»æ’­æ”¶å…¥å æ¯” | ~99% | é•¿å°¾ä¸»æ’­å‡ ä¹æ— æ”¶å…¥ |
| æ‰“èµç”¨æˆ·ç•™å­˜ | 78.9% | æ¯”æœªæ‰“èµç”¨æˆ·ä½ 10.3pp |

> **è­¦ç¤º**ï¼šè‹¥åˆ†é…å±‚ä¸åŠ çº¦æŸï¼Œå¯èƒ½åŠ å‰§é©¬å¤ªæ•ˆåº”

### æ¨¡å‹é…ç½®

| é¡¹ | é…ç½® |
|-----|------|
| æ¨¡å‹ | Ridge Regression (alpha=1.0) |
| ç›®æ ‡ | raw Y (é log) |
| ç‰¹å¾æ•° | **20** (Strict Mode) |
| æ ‡ç­¾çª—å£ | **1 åˆ†é’Ÿ** |
| å½’å› æ–¹å¼ | Last-Touch + gift_id å»é‡ |
| æ•°æ®åˆ’åˆ† | 7-7-7 æŒ‰å¤© |

### ç‰¹å¾åˆ—è¡¨ï¼ˆ20 ä¸ªï¼‰

| ç±»åˆ« | ç‰¹å¾ |
|------|------|
| Pair å†å² (3) | `pair_gift_cnt_hist`, `pair_gift_sum_hist`, `pair_gift_mean_hist` |
| User å†å² (3) | `user_gift_cnt_hist`, `user_gift_sum_hist`, `user_gift_mean_hist` |
| Streamer å†å² (3) | `str_gift_cnt_hist`, `str_gift_sum_hist`, `str_gift_mean_hist` |
| User Profile (5) | `age`, `gender`, `device_brand`, `device_price`, `is_live_streamer`, `is_photo_author` |
| Room (2) | `live_type`, `live_content_category` |
| Time (3) | `hour`, `day_of_week`, `is_weekend` |

### æ¨¡å‹å¯¹æ¯”

| æ¨¡å‹/æ–¹æ³• | RevCap@1% | CV | é…ç½® | å¤‡æ³¨ |
|-----------|-----------|-----|------|------|
| **Ridge (Strict, 1min)** | **51.4%** | **9.4%** | 20 features | âœ… Final Baseline |
| LightGBM + raw Y | ~45% | - | å¼ºæ­£åˆ™åŒ– | âŒ Tree å¤±è´¥ |
| Two-Stage + raw Y | ~43% | - | LR + Ridge | B2 å˜ä½“ |
| Direct + log Y | ~35% | - | log(1+Y) | log å‹ç¼© whale |
| Oracle | ~99% | - | çœŸå® top-1% | ç†è®ºä¸Šç•Œ |

### MVP éªŒæ”¶æ ‡å‡†

| æ ‡å‡† | é˜ˆå€¼ | å½“å‰ | çŠ¶æ€ |
|------|------|------|------|
| RevCap@1% | >50% | 51.4% | âœ… |
| CV | <10% | 9.4% | âœ… |

---

## ğŸ“š Quick Reference (Agent å¿…è¯»)

> æœ¬èŠ‚æ˜¯ç»™ Agent çš„å¿«é€Ÿå‚è€ƒï¼ŒåŒ…å« Baselineã€Dataã€Metric çš„æ ¸å¿ƒä¿¡æ¯ã€‚

### ğŸ”µ Baseline æ˜¯ä»€ä¹ˆï¼Ÿ

**æ¨¡å‹**ï¼šRidge Regression (alpha=1.0)
**ç›®æ ‡**ï¼šé¢„æµ‹æ¯æ¬¡ click çš„æ‰“èµé‡‘é¢ï¼ˆraw Yï¼Œé logï¼‰
**æ ¸å¿ƒç»“æœ**ï¼šRevCap@1%=51.4%ï¼ŒCV=9.4%

```python
# ä½¿ç”¨æ–¹æ³•
from gift_EVpred.data_utils import prepare_dataset, get_feature_columns
from sklearn.linear_model import Ridge

train_df, val_df, test_df = prepare_dataset()  # Strict + 1min çª—å£
feature_cols = get_feature_columns(train_df)   # 20 ä¸ªç‰¹å¾

model = Ridge(alpha=1.0)
model.fit(train_df[feature_cols], train_df['target_raw'])  # target_raw = gift_price_label
pred = model.predict(test_df[feature_cols])
```

**ç‰¹å¾åˆ—è¡¨ï¼ˆ20 ä¸ªï¼‰**ï¼š
| ç±»åˆ« | ç‰¹å¾ | å«ä¹‰ |
|------|------|------|
| Pair å†å² | `pair_gift_cnt_hist` | è¯¥ user-streamer pair è¿‡å»æ‰“èµæ¬¡æ•° |
| | `pair_gift_sum_hist` | è¯¥ pair è¿‡å»æ‰“èµæ€»é‡‘é¢ |
| | `pair_gift_mean_hist` | è¯¥ pair è¿‡å»æ‰“èµå‡å€¼ |
| User å†å² | `user_gift_cnt_hist` | è¯¥ user è¿‡å»æ€»æ‰“èµæ¬¡æ•° |
| | `user_gift_sum_hist` | è¯¥ user è¿‡å»æ€»æ‰“èµé‡‘é¢ |
| | `user_gift_mean_hist` | è¯¥ user è¿‡å»æ‰“èµå‡å€¼ |
| Streamer å†å² | `str_gift_cnt_hist` | è¯¥ streamer æ”¶åˆ°çš„æ€»æ‰“èµæ¬¡æ•° |
| | `str_gift_sum_hist` | è¯¥ streamer æ”¶åˆ°çš„æ€»é‡‘é¢ |
| | `str_gift_mean_hist` | è¯¥ streamer æ”¶åˆ°çš„æ‰“èµå‡å€¼ |
| User Profile | `age`, `gender`, `device_brand`, `device_price`, `is_live_streamer`, `is_photo_author` | ç”¨æˆ·é™æ€å±æ€§ |
| Room | `live_type`, `live_content_category` | ç›´æ’­é—´ç±»å‹ |
| Time | `hour`, `day_of_week`, `is_weekend` | æ—¶é—´ç‰¹å¾ |

**ç¦æ­¢ä½¿ç”¨çš„ç‰¹å¾**ï¼š
- `watch_live_time`ï¼špost-treatment æ³„æ¼ï¼ˆåŒ…å«æ‰“èµååœç•™æ—¶é—´ï¼‰
- ä»»ä½• `_past` åç¼€ä»¥å¤–çš„èšåˆç‰¹å¾

---

### ğŸŸ¢ Data æ˜¯ä»€ä¹ˆï¼Ÿ

**æ•°æ®æº**ï¼šKuaiLive (`data/KuaiLive/`)
**æ ·æœ¬é‡**ï¼šTrain 1.6M / Val 1.7M / Test 1.4M
**æ—¶é—´èŒƒå›´**ï¼š2025-05-04 ~ 2025-05-24ï¼ˆ21 å¤©ï¼Œ7-7-7 åˆ’åˆ†ï¼‰

**æ•°æ®å¤„ç†æ ¸å¿ƒè®¾è®¡**ï¼š
1. **Day-Frozen**ï¼šå†å²ç‰¹å¾åªç”¨ `day < click_day` çš„æ•°æ®ï¼ˆæ— æ³„æ¼ï¼‰
2. **Last-Touch å½’å› **ï¼šæ¯ä¸ª gift åªå½’å› ç»™æœ€è¿‘ 1 æ¡ clickï¼ˆæŒ‰ gift_id å»é‡ï¼‰
3. **1 åˆ†é’Ÿçª—å£**ï¼šclick å 1 åˆ†é’Ÿå†…çš„ gift å½’å› ç»™è¯¥ clickï¼ˆè¦†ç›– 92.6%ï¼‰
4. **Strict æ¨¡å¼**ï¼šdrop å¿«ç…§ç‰¹å¾ï¼ˆfans/accu_*ï¼‰ï¼Œé¿å… KuaiLive å¿«ç…§æ³„æ¼

```python
# æ ‡å‡†ç”¨æ³•
from gift_EVpred.data_utils import prepare_dataset, get_feature_columns

# é»˜è®¤é…ç½®ï¼šStrict + 1min çª—å£
train_df, val_df, test_df = prepare_dataset()

# å¯é€‰ï¼šBenchmark æ¨¡å¼ï¼ˆå«å¿«ç…§ç‰¹å¾ï¼Œ31 ä¸ªç‰¹å¾ï¼‰
train_df, val_df, test_df = prepare_dataset(strict_mode=False)
```

**å…³é”®å­—æ®µ**ï¼š
| å­—æ®µ | å«ä¹‰ |
|------|------|
| `user_id`, `streamer_id`, `live_id` | æ ‡è¯†å­—æ®µ |
| `timestamp` | click æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ |
| `gift_price_label` | æ ‡ç­¾ï¼šclick å 1 åˆ†é’Ÿå†…æ‰“èµé‡‘é¢ |
| `target_raw` | = gift_price_labelï¼ˆç”¨äºå›å½’ï¼‰ |
| `target` | = log(1 + gift_price_label)ï¼ˆä¸æ¨èï¼‰ |
| `is_gift` | = (gift_price_label > 0) |

---

### ğŸŸ¡ Metric æ˜¯ä»€ä¹ˆï¼Ÿ

**ä¸»æŒ‡æ ‡**ï¼šRevenue Capture @Kï¼ˆRevCap@Kï¼‰
**å®šä¹‰**ï¼šTop K% é¢„æµ‹æ•è·çš„å®é™…æ”¶å…¥å æ¯”

$$\text{RevCap@K} = \frac{\sum_{i \in \text{TopK}} y_i}{\sum_i y_i}$$

**ä¸ºä»€ä¹ˆç”¨ RevCap è€Œä¸æ˜¯ AUC/MAEï¼Ÿ**
- AUC è¡¡é‡"åŒºåˆ†èƒ½åŠ›"ï¼Œä¸å…³å¿ƒé‡‘é¢å¤§å°
- MAE è¡¡é‡"é¢„æµ‹è¯¯å·®"ï¼Œä½†å¤´éƒ¨è¯¯å·®å’Œå°¾éƒ¨åŒæƒ
- **RevCap è¡¡é‡"ä»·å€¼æ•è·"**ï¼Œç›´æ¥å¯¹é½ä¸šåŠ¡ç›®æ ‡

**è¾…åŠ©æŒ‡æ ‡**ï¼š
| æŒ‡æ ‡ | å«ä¹‰ | é˜ˆå€¼ |
|------|------|------|
| CV (ç¨³å®šæ€§) | æŒ‰å¤© RevCap çš„å˜å¼‚ç³»æ•° | < 10% |
| Whale Recall@K | Top K% é¢„æµ‹å¬å›å¤šå°‘å¤§é¢æ‰“èµ | - |
| 95% CI | Bootstrap ç½®ä¿¡åŒºé—´ | - |

```python
# è®¡ç®—æ–¹æ³•
from gift_EVpred.metrics import compute_revcap, compute_revcap_curve

revcap_1pct = compute_revcap(y_true, y_pred, k=0.01)
curve = compute_revcap_curve(y_true, y_pred, ks=[0.001, 0.005, 0.01, 0.02, 0.05, 0.1])
```

---

### ğŸ”´ å½“å‰é¢„æµ‹ç›®æ ‡ vs é•¿æœŸç›®æ ‡

**å½“å‰ï¼ˆPhase 1ï¼‰**ï¼š
- é¢„æµ‹ç›®æ ‡ï¼š`E[gift_amount | click]`
- è¯„ä¼°æŒ‡æ ‡ï¼šRevCap@1%
- å·²è¾¾æˆï¼š51.4%

**é•¿æœŸï¼ˆPhase 2+ï¼‰**ï¼š
- çŸ­æœŸæ”¶ç›Šï¼š$r^{rev}_t = E[\text{gift\_amount}_{t:t+H} | u, s, ctx, a]$
- ç”¨æˆ·ç•™å­˜ï¼š$r^{usr}_t = E[\text{return}_{t+1d} | u, history, a]$
- ç”Ÿæ€å¥åº·ï¼š$r^{eco}_t = -\lambda \cdot \text{concentration}(\text{exposure/revenue})$

**å…³é”®åŒºåˆ†**ï¼š
- å½“å‰ï¼šé¢„æµ‹"è¿™æ¡æ ·æœ¬æ˜¯å¦/ä¼šé€å¤šå°‘ç¤¼"
- é•¿æœŸï¼šé¢„æµ‹"ç»™äº†è¿™ä¸ªè¡ŒåŠ¨ï¼ˆåˆ†é…ï¼‰ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆ"

---

## 1) ğŸ¯ ä»»åŠ¡å®šä¹‰

### 1.1 é—®é¢˜è®¾å®š

```
ã€Click-level EV é¢„æµ‹ã€‘

è¾“å…¥ï¼š(user_id, streamer_id, live_id, t_click) + è¿›å…¥æ—¶åˆ»å¯ç”¨ç‰¹å¾
è¾“å‡ºï¼šæœªæ¥çª—å£ [t_click, t_click+W] å†…ç¤¼ç‰©é‡‘é¢æ€»å’Œçš„æœŸæœ› (EV)
æ ‡ç­¾ï¼šgift_price_label = sum(gift_price) within window W
```

| é¡¹ | è§„æ ¼ |
|---|---|
| é¢„æµ‹ç²’åº¦ | Click-levelï¼ˆç”¨æˆ·è¿›å…¥ç›´æ’­é—´æ—¶åˆ»ï¼‰ |
| æ ‡ç­¾çª—å£ | W = **1 minute**ï¼ˆé»˜è®¤ï¼Œå¯è°ƒ 5/10/60ï¼‰ |
| å½’å› æ¨¡å‹ | Last-Touchï¼ˆæ¯ä¸ª gift åªå½’å› æœ€è¿‘ 1 æ¡ clickï¼ŒæŒ‰ gift_id å»é‡ï¼‰ |
| é¢„æµ‹ç›®æ ‡ | **raw Y**ï¼ˆé log(1+Y)ï¼‰ |
| è¾…åŠ©æ ‡ç­¾ | is_gift = (gift_price_label > 0) |
| é™æ€ç‰¹å¾ | **Strict æ¨¡å¼**ï¼ˆé»˜è®¤ï¼Œdrop å¿«ç…§ç‰¹å¾ï¼›Benchmark å¯é€‰ï¼‰ |

### 1.2 ä¸šåŠ¡ç›®æ ‡

```
å½“å‰é˜¶æ®µç›®æ ‡ï¼šè¯†åˆ«"å¤§å“¥"ï¼ˆé«˜ä»·å€¼æ‰“èµç”¨æˆ·ï¼‰
ä¸‹æ¸¸åº”ç”¨ï¼šåˆ†é…ä¼˜åŒ–ï¼ˆæŠŠå¤§å“¥åˆ†é…ç»™åˆé€‚çš„ä¸»æ’­ï¼‰
```

| é˜¶æ®µ | ç›®æ ‡ | æŒ‡æ ‡ |
|------|------|------|
| **Phase 1ï¼ˆå½“å‰ï¼‰** | è¯†åˆ«å¤§å“¥ + é¢„æµ‹æ‰“èµé‡‘é¢ | Revenue Capture @K |
| Phase 2ï¼ˆåç»­ï¼‰ | User-Streamer åå¥½åŒ¹é… | å¾…å®š |
| Phase 3ï¼ˆè¿œæœŸï¼‰ | åˆ†é…ä¼˜åŒ– + é•¿æœŸæ”¶ç›Š | Total Revenue + LTV |

### 1.3 ç‰¹å¾æ„é€ ç­–ç•¥

| ç­–ç•¥ | å®šä¹‰ | çŠ¶æ€ | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|
| **A. Frozen** | ä»…ç”¨ Train çª—å£å†…å†å²è®¡ç®—ç»Ÿè®¡é‡ï¼›Val/Test åªæŸ¥è¡¨ | âœ… å½“å‰ä½¿ç”¨ | å¿«é€Ÿè¿­ä»£ã€æ— æ³„æ¼ä¿è¯ |
| B. Rolling | å¯¹æ¯ä¸ª click ä¸¥æ ¼ç”¨ `gift_ts < click_ts` æ„é€ ç‰¹å¾ | â³ åç»­è¿­ä»£ | æ›´ç²¾ç¡®ã€åœ¨çº¿æ¨ç†å¯¹é½ |

**å½“å‰é€‰æ‹© Frozen çš„åŸå› **ï¼š
1. å®ç°ç®€å•ï¼Œæ— æ³„æ¼é£é™©
2. å·²éªŒè¯ 200/200 æ ·æœ¬é€šè¿‡
3. å½“å‰é˜¶æ®µä¸“æ³¨æ¨¡å‹å’Œç›®æ ‡å˜é‡é€‰æ‹©ï¼Œä¸å¢åŠ ç‰¹å¾å¤æ‚åº¦

---

## 2) ğŸŒ² æ ¸å¿ƒå‡è®¾æ ‘

```
ğŸŒ² æ ¸å¿ƒ: å¦‚ä½•å»ºæ¨¡ EVï¼ˆæœŸæœ›æ‰“èµï¼‰ä»¥è¯†åˆ«é«˜ä»·å€¼ç”¨æˆ·ï¼Ÿ
â”‚
â”œâ”€â”€ Q0: åŸºç¡€è®¾æ–½æ­£ç¡®æ€§ âœ…
â”‚   â”œâ”€â”€ Q0.1: æ•°æ®æ³„æ¼å·²æ¶ˆé™¤ï¼Ÿ â†’ âœ… Day-Frozenï¼Œ200/200 éªŒè¯é€šè¿‡
â”‚   â”œâ”€â”€ Q0.2: ä»»åŠ¡å®šä¹‰æ­£ç¡®ï¼Ÿ â†’ âœ… Click-levelï¼Œgift_rate ~1.5%
â”‚   â””â”€â”€ Q0.3: è¯„ä¼°æŒ‡æ ‡å¯¹é½ä¸šåŠ¡ï¼Ÿ â†’ âœ… Revenue Capture @K
â”‚
â”œâ”€â”€ Q1: å¦‚ä½•å»ºæ¨¡ EVï¼Ÿ âœ… å·²æ”¶æ•›
â”‚   â”œâ”€â”€ Q1.1: Direct vs Two-Stageï¼Ÿ â†’ âœ… Direct æ›´ä¼˜ï¼ˆRevCap 52.68% vs 45.66%ï¼‰
â”‚   â”œâ”€â”€ Q1.2: Raw Y vs Log(1+Y)ï¼Ÿ â†’ âœ… Raw Y æ˜¾è‘—æ›´ä¼˜ï¼ˆ+39.6%ï¼‰
â”‚   â”œâ”€â”€ Q1.3: Three-Stage Whale-onlyï¼Ÿ â†’ âŒ ä¸å¦‚ Direct raw Y
â”‚   â””â”€â”€ Q1.4: æœ€å¼ºç‰¹å¾ï¼Ÿ â†’ âœ… pair_gift_cnt_hist
â”‚
â””â”€â”€ Q2: ä¸‹ä¸€æ­¥ä¼˜åŒ–æ–¹å‘ï¼Ÿ â³
    â”œâ”€â”€ Q2.1: LightGBM æ›¿ä»£ Linearï¼Ÿ â†’ âŒ å¤±è´¥ï¼ˆ-3.1%~-14.5%ï¼‰ï¼ŒTree ä¸é€‚åˆç¨€ç–å›å½’
    â”œâ”€â”€ Q2.2: Whale-specific ç‰¹å¾ï¼Ÿ â†’ â³ å¾…éªŒè¯
    â”œâ”€â”€ Q2.3: Rolling ç‰¹å¾ï¼Ÿ â†’ â³ åç»­è¿­ä»£
    â””â”€â”€ **Q2.4: é¢„æµ‹ç›®æ ‡æ‰©å±•ï¼Ÿ â†’ âœ… å·²éªŒè¯ï¼ˆéƒ¨åˆ†æˆåŠŸï¼‰**
        â”œâ”€â”€ Q2.4.1: ç”¨æˆ·ç•™å­˜å¯é¢„æµ‹ï¼Ÿ â†’ âŒ AUC=0.57ï¼ˆæ¥è¿‘éšæœºï¼‰
        â”œâ”€â”€ Q2.4.2: çŸ­æœŸæ”¶ç›Š vs ç•™å­˜æƒè¡¡ï¼Ÿ â†’ âœ… å‘ç°è´Ÿç›¸å…³ï¼ˆæ‰“èµç”¨æˆ·ç•™å­˜ä½ 10.3ppï¼‰
        â””â”€â”€ Q2.4.3: ç”Ÿæ€çº¦æŸå¦‚ä½•å»ºæ¨¡ï¼Ÿ â†’ âœ… Gini=0.93ï¼ˆæåº¦é›†ä¸­ï¼‰ï¼Œä½œä¸ºåˆ†é…çº¦æŸ

Legend: âœ… å·²éªŒè¯ | âŒ å·²å¦å®š | â³ å¾…éªŒè¯
```

---

## 3) å£å¾„å†»ç»“ï¼ˆå”¯ä¸€æƒå¨ï¼‰

| é¡¹ç›® | è§„æ ¼ |
|---|---|
| Dataset | KuaiLive (`data/KuaiLive/`) |
| Train / Val / Test | 1,629,415 / 1,717,199 / 1,409,533 (7-7-7 by days) |
| æ—¶é—´èŒƒå›´ | 2025-05-04 ~ 2025-05-24 |
| **æ ‡ç­¾çª—å£** | **1 minute**ï¼ˆé»˜è®¤ï¼Œ98.2% gift åœ¨åŒæ¯«ç§’å†…å‘ç”Ÿï¼‰ |
| **å½’å› æ¨¡å‹** | Last-Touch + gift_id å»é‡ï¼ˆæ¯ä¸ª gift åªå½’å›  1 æ¬¡ï¼‰ |
| **é™æ€ç‰¹å¾æ¨¡å¼** | **Strict**ï¼ˆé»˜è®¤ï¼Œ20 ç‰¹å¾ï¼‰/ Benchmarkï¼ˆ31 ç‰¹å¾ï¼Œå«å¿«ç…§ï¼‰ |
| **ä¸»æŒ‡æ ‡** | **RevCap@1%=51.4%** + **CV=9.4%** |
| Seed | 42 |

**Label Attribution Coverage**ï¼ˆ1min windowï¼‰ï¼š
- Count: 92.6% (67,266 / 72,646)
- Value: 90.0% (5.4M / 6.0M yuan)
- Orphan: No click 5.8% + Outside window 4.2%

**æ•°æ®å¤„ç†å…¥å£**ï¼š
```python
from gift_EVpred.data_utils import prepare_dataset, get_feature_columns
train_df, val_df, test_df = prepare_dataset()  # é»˜è®¤ Strict + 1min
feature_cols = get_feature_columns(train_df)   # 20 ä¸ªç‰¹å¾
```

> è§„åˆ™ï¼šä»»ä½•å£å¾„å˜æ›´å¿…é¡»å†™å…¥ Â§9 å˜æ›´æ—¥å¿—ã€‚

---

## 4) å½“å‰ç­”æ¡ˆ & æˆ˜ç•¥æ¨è

### 4.1 æˆ˜ç•¥æ¨è

- **å½“å‰æœ€ä¼˜**ï¼šRidge + raw Yï¼ˆRevCap=51.4%ï¼Œå·²è¾¾ Linear ç“¶é¢ˆï¼‰
- **ä¸‹ä¸€æ­¥é‡ç‚¹**ï¼šé¢„æµ‹ç›®æ ‡æ‰©å±•ï¼ˆä» gift åˆ°è¡ŒåŠ¨åæœï¼‰

| Route | ä¸€å¥è¯å®šä½ | å½“å‰å€¾å‘ | å…³é”®ç†ç”± |
|---|---|---|---|
| **Route A: Ridge + raw Y** | Final Baseline | ğŸŸ¢ å·²éªŒè¯ | RevCap=51.4%, CV=9.4% |
| Route B: LightGBM | éçº¿æ€§ | âŒ å¤±è´¥ | Tree ä¸é€‚åˆç¨€ç–æ•°æ® |
| **Route C: å¤šç›®æ ‡é¢„æµ‹** | è¡ŒåŠ¨åæœé¢„æµ‹ | ğŸ”´ **æ–°ç«‹é¡¹** | çŸ­æœŸæ”¶ç›Š + ç•™å­˜ + ç”Ÿæ€ |
| Route D: åˆ†é…ä¼˜åŒ– | ä¸Šå±‚åº”ç”¨ | â³ è¿œæœŸ | ä¾èµ– Route C ç»“æœ |

### 4.2 åˆ†æ”¯ç­”æ¡ˆè¡¨

| åˆ†æ”¯ | å½“å‰ç­”æ¡ˆ | ç½®ä¿¡åº¦ | å†³ç­–å«ä¹‰ | è¯æ® |
|---|---|---|---|---|
| Q1.1 Direct vs Two-Stage | Direct æ›´ä¼˜ | ğŸŸ¢ | ä¸ç”¨ Two-Stage | exp_raw_vs_log |
| Q1.2 Raw Y vs Log Y | Raw Y æ˜¾è‘—æ›´ä¼˜ | ğŸŸ¢ | é¢„æµ‹ç›®æ ‡ç”¨ raw Y | exp_raw_vs_log |
| Q1.3 Three-Stage | ä¸å¦‚ Direct | ğŸŸ¢ | ä¸ç”¨ Three-Stage | exp_three_stage |

---

## 5) æ´è§æ±‡åˆ

> åªæ”¶å½•"ä¼šæ”¹å˜å†³ç­–"çš„æ´è§

### 5.1 æ–¹æ³•è®ºæ´è§ï¼ˆEV å»ºæ¨¡é€šç”¨ï¼‰

| # | æ´è§ | è§‚å¯Ÿ | è§£é‡Š | å†³ç­–å½±å“ |
|---|---|---|---|---|
| **M1** | **æ’åº/åˆ†é… > é€æ¡é¢„æµ‹** | ä¸éœ€è¦"é¢„æµ‹å‡†æ¯ä¸€æ¡" | æŠŠæ›´å¯èƒ½äº§ç”Ÿä»·å€¼çš„æ”¾åˆ°æ›´å¥½ä½ç½®å³å¯ | è¯„ä¼°ç”¨ RevCap@Kï¼Œä¸ç”¨ MAE/RMSE |
| **M2** | **RevCap@K æ˜¯å…³é”®æŒ‡æ ‡** | Top K% æ›å…‰æ•è·çš„æ”¶å…¥å æ¯” | æ‰“èµæ˜¯é‡å°¾åˆ†å¸ƒï¼Œä»·å€¼é›†ä¸­åœ¨å¤´éƒ¨ | MVP æ ‡å‡†ï¼šTop 1% æ•è· >50% æ”¶å…¥ |
| **M3** | **æ—¶é—´çª—çºªå¾‹** | ä»»ä½•ç‰¹å¾å¿…é¡»æ˜¯ t_click ä¹‹å‰å¯å¾— | âŒ ä¼šè¯ç»“æŸåæ‰çŸ¥é“çš„ä¿¡æ¯ï¼ˆæœ€ç»ˆåœç•™æ—¶é•¿ç­‰ï¼‰ | ä¸¥æ ¼æŒ‰æ—¶é—´åˆ‡åˆ† + æ³„æ¼æ£€æŸ¥ |
| **M4** | **å†å²æ‰“èµæ˜¯æœ€å¼ºä¿¡å·** | pair-level å†å² > user/streamer å…¨å±€ | åŒä¸€ç”¨æˆ·å¯¹ä¸åŒä¸»æ’­æ‰“èµæ¦‚ç‡å·®å¾ˆå¤š | é‡ç‚¹æŒ–æ˜ pair ç‰¹å¾ |
| **M5** | **æ— å¸¸ â‰  ä¸èƒ½å»ºæ¨¡** | å•æ¬¡æ‰“èµéš¾é¢„æµ‹ï¼Œä½†æ¡ä»¶æ¦‚ç‡ç¨³å®š | è§„æ¨¡ä¸Šæœ‰ç³»ç»Ÿæ€§å·®å¼‚ï¼šæœ‰äºº"å‡ ä¹ä¸æ‰“èµ"ï¼Œæœ‰äºº"ç¨³å®šé«˜æ¶ˆè´¹" | æ¨¡å‹å­¦åˆ°ç³»ç»Ÿæ€§å·®å¼‚å³æœ‰ä»·å€¼ |
| **M6** | **ä¸šç•Œæƒ¯ä¾‹ï¼šæ”¶å…¥ç”¨ rawï¼Œå‚ä¸ç”¨ log** | ç”µå•† GMV ç”¨ raw bidï¼Œè§†é¢‘æ¨èç”¨ log watch_time | ä¸šåŠ¡ç›®æ ‡å†³å®šç›®æ ‡å˜æ¢ï¼šæ”¶å…¥æœ€å¤§åŒ– â†’ rawï¼›ç”¨æˆ·è¦†ç›– â†’ log | æ‰“èµåœºæ™¯ = æ”¶å…¥åœºæ™¯ â†’ raw Y |
| **M7** | **watch_live_time æ˜¯ post-treatment** | åŒ…å«æ‰“èµåçš„åœç•™æ—¶é—´ | æœ¬è´¨æ˜¯ç»“æœ/ä¸­ä»‹å˜é‡ï¼Œclick æ—¶åˆ»ä¸å¯å¾— | å½“å‰ session çš„ watch_time **å¿…é¡»åˆ é™¤** |
| **M8** | **å¯ç”¨æ›¿ä»£ï¼šå†å²è§‚çœ‹å…ˆéªŒ** | user/pair/streamer å†å²å¹³å‡è§‚çœ‹æ—¶é•¿ | è¿™äº›æ˜¯ pre-treatmentï¼Œæ»¡è¶³ `< click_ts` å³å¯ç”¨ | ç”¨å†å²å…ˆéªŒä»£æ›¿å½“å‰ session |
| **M9** | **Partial dwell æ˜¯åˆç†äºŒé˜¶æ®µä¿¡å·** | è¿›å…¥å 5s/10s çš„åœç•™/äº’åŠ¨ | äº’åŠ¨â†’æ‰“èµ çš„å› æœé“¾è·¯æ›´åˆç† | è‹¥å…è®¸å»¶è¿Ÿæ‰“åˆ†ï¼Œå¯ä½œä¸ºé‡æ’åºç‰¹å¾ |
| **M10** | **Train å†…éƒ¨ä¹Ÿéœ€è¦æ—¶é—´ä¸€è‡´æ€§** | ç”¨"æ•´çª—èšåˆ + last_ts æŒ¡"ä¼šåˆ¶é€ åˆ†å¸ƒåç§» | å¯¹ train æ—©æœŸæ ·æœ¬ï¼špair ç»Ÿè®¡è¢«æ¸…é›¶ï¼Œä¸ val/test æœºåˆ¶ä¸ä¸€è‡´ | Train ä¹Ÿè¦ rolling æˆ– day-snapshot |
| **M11** | **Two-Stage ä¸æ˜¯å®Œå…¨æ²¡ç”¨** | Two-Stage åœ¨ NDCG@100 å¯èƒ½æ›´å¥½ | é«˜ç¨€ç–ä¸‹ Stage2 æ ·æœ¬å°‘è¯¯å·®å¤§ï¼Œä½†å¯¹"é‡‘ä¸»å†…éƒ¨æ’åº"å¯èƒ½æœ‰æ•ˆ | RevCap ç”¨ Directï¼Œç²¾ç»†æ’åºå¯è¯• Two-Stage |

### 5.2 æœ¬é¡¹ç›®éªŒè¯çš„æ´è§

| # | æ´è§ | è§‚å¯Ÿ | è§£é‡Š | å†³ç­–å½±å“ | è¯æ® |
|---|---|---|---|---|---|
| **E1** | **Raw Y >> Log Y** | RevCap +39.6% | Log å‹ç¼© whale ä¿¡å·ï¼ˆ10å…ƒ vs 1000å…ƒå·®è·å˜å°ï¼‰ | ç”¨ raw Y | exp_raw_vs_log |
| **E2** | **RevCap â‰  Spearman** | è´Ÿç›¸å…³ | æ•´ä½“æ’åº vs å¤´éƒ¨ç²¾å‡†æ˜¯ä¸åŒç›®æ ‡ | ç”¨ RevCap è¯„ä¼° | exp_raw_vs_log |
| **E3** | **Direct > Two-Stage** | 52.68% vs 45.66% | Two-Stage å¼•å…¥é¢å¤–è¯¯å·® | ç”¨ Direct | exp_raw_vs_log |
| **E4** | **Pair å†å²æœ€å¼º** | ç³»æ•° 0.194 | å†å²æ‰“èµè¡Œä¸ºæ˜¯æœ€å¼ºé¢„æµ‹ä¿¡å· | é‡ç‚¹æŒ–æ˜ pair ç‰¹å¾ | exp_baseline |
| **E5** | **Day-Frozen æ— æ³„æ¼** | 200/200 é€šè¿‡ | merge_asof + allow_exact_matches=False | å¯ä¿¡å®éªŒåŸºç¡€ | exp_baseline |
| **E6** | **é˜ˆå€¼è¶Šé«˜ RevCap è¶Šé«˜** | P90 > P80 > ... > P50 | ä¸“æ³¨"è¶…çº§å¤§å“¥"æ¯”è¦†ç›–å…¨ä½“ gifters æ›´æœ‰æ•ˆ | raw Y éšå¼å®ç° | exp_three_stage |
| **E7** | **Ridge alpha ä¸æ•æ„Ÿ** | alpha 0.001~1000 RevCap ä¸å˜ | ç‰¹å¾æ— ä¸¥é‡å…±çº¿æ€§ï¼ŒLinear å·²è¾¾ç“¶é¢ˆ | éçº¿æ€§æœªå¿…æœ‰æ•ˆ | alpha_sweep |
| **E8** | **LightGBM å›å½’å¤±è´¥** | RevCap -3.1%~-14.5% | 98.5% ä¸º 0ï¼Œæ ‘æ¨¡å‹é¢„æµ‹ä¼—æ•° | ç¨€ç–å›å½’ç”¨ Linear | exp_lightgbm |
| **E9** | **LightGBM åˆ†ç±»æˆåŠŸä½†æ— ç”¨** | P(whale) AUC=0.8533 (+38%) | åˆ†ç±»ä¸¢å¤±é‡‘é¢ä¿¡æ¯ï¼š100å…ƒ vs 10000å…ƒ whale åˆ†æ•°ç›¸åŒ | RevCap ç”¨å›å½’ä¸ç”¨åˆ†ç±» | exp_lightgbm |
| **E10** | **AUC â‰  RevCap** | AUC é«˜ä½† RevCap ä½ | AUC è¡¡é‡"åŒºåˆ†èƒ½åŠ›"ï¼ŒRevCap è¡¡é‡"ä»·å€¼æ•è·" | ç”¨ RevCap è¯„ä¼° | exp_lightgbm |
| **E11** | **âš ï¸ Cold Start æ•ˆåº”** | Train RevCap=29.4% << Test=52.6% | Day-Frozen ç‰¹å¾åœ¨ Train æ—©æœŸå‡ ä¹å…¨ä¸º 0ï¼ˆæ•°æ®é›†åˆšå¼€å§‹ï¼‰ | **ä¸æ˜¯æ³„æ¼**ï¼Œè¯„ä¼°çœ‹ Test | exp_baseline_ridge |
| **E12** | **âœ… Over-Attribution ä¿®å¤** | 8.43% gift è¢«å¤šæ¡ click è®¡å…¥ï¼Œ16.78% é‡‘é¢è†¨èƒ€ | å¤šæ¬¡è¿›å…¥åŒä¸€ç›´æ’­é—´æ—¶ï¼ŒåŒä¸€ gift è¢«å¤šæ¡ click çš„çª—å£è¦†ç›– | **Last-Touch**ï¼šæ¯ä¸ª gift åªå½’å› æœ€è¿‘ 1 æ¡ click | card_label_duplicate |
| **E13** | **âœ… å¿«ç…§ç‰¹å¾è´¡çŒ®ä½** | Strict (20ç‰¹å¾) vs Benchmark (31ç‰¹å¾) RevCap å®Œå…¨ç›¸åŒ | 11 ä¸ªå¿«ç…§ç‰¹å¾åªå  22.6% ç³»æ•°æƒé‡ï¼ŒTop5 å…¨æ˜¯å†å²æ‰“èµç‰¹å¾ | å®‰å¿ƒä½¿ç”¨ Strict æ¨¡å¼ï¼Œæ— éœ€æ‹…å¿ƒæŸå¤±é¢„æµ‹èƒ½åŠ› | exp_strict_vs_benchmark |
| **E14** | **âœ… pair_hist æ— æ³„æ¼ä½†æé‡è¦** | å»æ‰ pair_* å RevCap -12.9ppï¼ŒCV +17.2pp | Day-Frozen ä¸¥æ ¼ `day < click_day`ï¼Œ10/10 éªŒè¯é€šè¿‡ | åˆç†ä¿¡å·ï¼Œä¸æ˜¯æ³„æ¼ | card_pair_hist_analysis |
| **E15** | **âš ï¸ é¦–æ¬¡æ‰“èµé¢„æµ‹èƒ½åŠ›å¼±** | 56% æ”¶å…¥æ¥è‡ªé¦–æ¬¡æ‰“èµï¼Œä½† RevCap åªæœ‰ 29.6% | æ¨¡å‹è¿‡åº¦ä¾èµ–å¤è´­ä¿¡å·ï¼Œcold-start åœºæ™¯èƒ½åŠ›ä¸è¶³ | éœ€ä¼˜åŒ– user/streamer çº§ç‰¹å¾ | card_pair_hist_analysis |
| **E16** | **âŒ ç•™å­˜éš¾ä»¥é¢„æµ‹** | AUC=0.5722ï¼ˆæ¥è¿‘éšæœºï¼‰ | å½“å‰ç‰¹å¾æ— æ³•æœ‰æ•ˆé¢„æµ‹ç”¨æˆ·æ¬¡æ—¥ç•™å­˜ | æ”¾å¼ƒä½œä¸ºé¢„æµ‹ç›®æ ‡ï¼Œæ”¹ä¸ºè§‚æµ‹æŒ‡æ ‡ | exp_prediction_target_expansion |
| **E17** | **ğŸ”¥ æ‰“èµä¸ç•™å­˜è´Ÿç›¸å…³** | æ‰“èµç”¨æˆ·ç•™å­˜ 78.9% vs æœªæ‰“èµ 89.2%ï¼ˆ-10.3ppï¼‰ | "æ»¡è¶³åç¦»å¼€"æ•ˆåº” æˆ– å¶å‘æ€§è®¿é—® | çŸ­æœŸæ”¶ç›Š â‰  é•¿æœŸä»·å€¼ï¼Œåˆ†é…ç­–ç•¥éœ€æƒè¡¡ | exp_prediction_target_expansion |
| **E18** | **âœ… æ”¶å…¥æåº¦é›†ä¸­** | Gini=0.926ï¼ŒTop 1% ä¸»æ’­å  93.7% æ”¶å…¥ | å¤´éƒ¨ä¸»æ’­å¸é‡‘æ•ˆåº” | åˆ†é…å±‚éœ€æ·»åŠ ç”Ÿæ€çº¦æŸï¼ˆå‡¹æ”¶ç›Šå‡½æ•°ï¼‰ | exp_prediction_target_expansion |
| **E19** | **âŒ æ ·æœ¬åŠ æƒæ— æ•ˆ** | Î±=0 æœ€ä¼˜ï¼ŒÎ±>0 æ€§èƒ½ä¸‹é™ | ç­‰æƒå·²è¶³å¤Ÿæ•è·å¤´éƒ¨ä¿¡å·ï¼ŒåŠ æƒè¿‡æ‹Ÿåˆ | ä¿æŒç­‰æƒå›å½’ï¼Œä¸ç”¨æ ·æœ¬åŠ æƒ | exp_weighted_regression |
| **E20** | **âš ï¸ å†å²è§‚çœ‹å…ˆéªŒæ— å¢ç›Š** | RevCap@1% +0.01ppï¼Œç³»æ•°å·® 48 å€ | ç¤¼ç‰©å†å²å·²é¥±å’Œï¼Œè§‚çœ‹è¢«æ‰“èµéšå« | ä¸åŠ å…¥è§‚çœ‹ç‰¹å¾ï¼Œä¸“æ³¨æ‰“èµå†å²æŒ–æ˜ | exp_watch_history_prior |

**Linear æ¨¡å‹ç“¶é¢ˆç¡®è®¤**ï¼šRidge alpha sweep æ˜¾ç¤ºæ— è°ƒå‚ç©ºé—´ï¼ŒRevCap@1%=51.0%ï¼ˆä¿®å¤åï¼‰æ˜¯ Linear + Day-Frozen çš„ä¸Šç•Œã€‚LightGBM æ— æ³•çªç ´æ­¤ç“¶é¢ˆï¼ˆTree ä¸é€‚åˆç¨€ç–å›å½’ï¼‰ã€‚

### 5.3 âš ï¸ Cold Start æ•ˆåº”è¯¦è§£ï¼ˆé‡è¦ï¼‰

> **ç°è±¡**ï¼šTrain RevCap@1%=29.4% è¿œä½äº Test RevCap@1%=52.6%ï¼Œå·®è· 23pp

**ä¸æ˜¯æ•°æ®æ³„æ¼ï¼è€Œæ˜¯å†å²ç‰¹å¾ç§¯ç´¯ä¸è¶³**ï¼š

| æ—¥æœŸ | RevCap@1% | pair_hist éé›¶ç‡ | è¯´æ˜ |
|------|-----------|------------------|------|
| Train 05-04 | **0.1%** | 0.00% | æ•°æ®é›†ç¬¬ä¸€å¤©ï¼Œå®Œå…¨æ²¡å†å² |
| Train 05-10 | 45.3% | 2.09% | ç§¯ç´¯ 6 å¤©å†å²ï¼Œæ¥è¿‘ Test |
| Test 05-18 | 55.3% | 3.33% | 14 å¤©å†å²ï¼Œä¿¡æ¯å……è¶³ |

**ç»“è®º**ï¼š
- âœ… Day-Frozen è®¾è®¡æ­£ç¡®ï¼Œæ— æ³„æ¼
- âœ… æ¨¡å‹ä¾èµ–å†å²ä¿¡æ¯ï¼Œå†å²è¶Šå……è¶³æ€§èƒ½è¶Šå¥½
- âœ… å®é™…éƒ¨ç½²æ—¶ç³»ç»Ÿæœ‰è¶³å¤Ÿå†å²ï¼Œé¢„æœŸæ€§èƒ½æ¥è¿‘ Test (52.6%)
- âš ï¸ **è¯„ä¼°æ—¶ä¸åº”å°† Train RevCap ä½œä¸ºæ€§èƒ½å‚è€ƒ**

---

## 6) å†³ç­–ç©ºç™½ï¼ˆDecision Gapsï¼‰

| DG | æˆ‘ä»¬ç¼ºçš„ç­”æ¡ˆ | ä¸ºä»€ä¹ˆé‡è¦ | ä»€ä¹ˆç»“æœèƒ½å…³é—­å®ƒ | å†³ç­–è§„åˆ™ |
|---|---|---|---|---|
| ~~DG1~~ | ~~LightGBM æ˜¯å¦ä¼˜äº Linearï¼Ÿ~~ | ~~Linear å·²ç¡®è®¤åˆ°ç“¶é¢ˆ~~ | âŒ **å·²å…³é—­** | LightGBM å¤±è´¥ï¼ˆ-3.1%ï¼‰ï¼Œè½¬å‘ç‰¹å¾å·¥ç¨‹ |
| **DG2** | **Whale-specific ç‰¹å¾æœ‰ç”¨å—ï¼Ÿ** | å¯èƒ½è¿›ä¸€æ­¥åŒºåˆ†å¤§å“¥ | RevCap æå‡ | If >2% æå‡ â†’ åŠ å…¥ï¼›Else â†’ ä¸åŠ  |
| **DG3** | **Frozen vs Rolling å“ªä¸ªå¯¹é½çº¿ä¸Šï¼Ÿ** | å†³å®šè¯„ä¼°åè®® | æ˜ç¡®çº¿ä¸Šç‰¹å¾æ›´æ–°é¢‘ç‡ | æ‰¹å¤„ç†â†’Frozenï¼›å®æ—¶è®¡æ•°å™¨â†’Rolling |
| DG4 | Partial dwell (5s/10s) å€¼å¾—åšå—ï¼Ÿ | è‹¥å…è®¸å»¶è¿Ÿæ‰“åˆ†ï¼Œå¯ä½œä¸ºé‡æ’åºç‰¹å¾ | å·¥ç¨‹å¯è¡Œæ€§ + RevCap å¢ç›Š | éœ€è¦äº§å“ä¾§ç¡®è®¤æ˜¯å¦å…è®¸å»¶è¿Ÿæ‰“åˆ† |
| **DG5** | **MLP æ˜¯å¦ä¼˜äº Linearï¼Ÿ** | Tree å¤±è´¥ï¼ŒNN å¯èƒ½æ›´é€‚åˆç¨€ç–æ•°æ® | RevCap å¯¹æ¯” | If >55% â†’ ç”¨ MLPï¼›Else â†’ ä¸“æ³¨ç‰¹å¾å·¥ç¨‹ |

### 6.1 Protocol Trade-offï¼ˆFrozen vs Rollingï¼‰

| Protocol | å®šä¹‰ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---|---|---|---|---|
| **A. Frozen-Serving** | Train ç»“æŸæ—¶ freeze ç»Ÿè®¡ï¼›Val/Test åªæŸ¥è¿™ä»½è¡¨ | ç®€å•ã€ä½æˆæœ¬ã€å¯ä¸Šçº¿ | åŒå¤©å†…ä¿¡æ¯å®Œå…¨å†»ç»“ï¼Œä¿¡å·æŸå¤± | ç¦»çº¿æ‰¹å¤„ç†ç‰¹å¾ |
| **B. Online-Rolling** | Val/Test å…è®¸ç”¨"åˆ°è¯¥ click ä¸ºæ­¢çš„å…¨éƒ¨å†å²" | æ›´ç²¾ç¡®ã€ç†è®ºä¸Šç•Œ | éœ€è¦å®æ—¶è®¡æ•°å™¨ï¼Œå·¥ç¨‹å¤æ‚ | æœ‰æµå¼ç‰¹å¾åŸºç¡€è®¾æ–½ |

> **å»ºè®®**ï¼šä¸¤å¥—åè®®éƒ½è·‘å¹¶æ±‡æŠ¥ï¼Œæ—¢è¯„ä¼°æ¨¡å‹æ•ˆæœï¼Œä¹Ÿè¯„ä¼°"å®æ—¶ç‰¹å¾çš„å·¥ç¨‹æŠ•å…¥æ˜¯å¦å€¼å¾—"

---

## 7) è®¾è®¡åŸåˆ™

### 7.1 å·²ç¡®è®¤åŸåˆ™

| # | åŸåˆ™ | å»ºè®® | é€‚ç”¨èŒƒå›´ | è¯æ® |
|---|---|---|---|---|
| P1 | **ç”¨ raw Yï¼Œä¸ç”¨ log(1+Y)** | é¢„æµ‹ç›®æ ‡ = raw gift_price | æ”¶å…¥æœ€å¤§åŒ–åœºæ™¯ | exp_raw_vs_log |
| P2 | **ç”¨ RevCapï¼Œä¸ç”¨ Spearman** | RevCap@1% ä½œä¸ºä¸»æŒ‡æ ‡ | é«˜ä»·å€¼ç”¨æˆ·è¯†åˆ« | exp_raw_vs_log |
| P3 | **ç”¨ Day-Frozen ç‰¹å¾** | `day < current_day` çš„å†å² | æ— æ³„æ¼ä¿è¯ | exp_baseline |
| P4 | **ç¦æ­¢å½“å‰ session çš„ watch_live_time** | Post-treatment æ³„æ¼ç‰¹å¾ | æ‰€æœ‰å®éªŒ | data_utils.py |
| P5 | **ä½¿ç”¨ data_utils.py** | ç»Ÿä¸€æ•°æ®å¤„ç†å…¥å£ | æ‰€æœ‰å®éªŒ | - |
| **P6** | **Train/Val/Test æœºåˆ¶å¿…é¡»ä¸€è‡´** | è‹¥ Frozen åˆ™å…¨ Frozenï¼›è‹¥ Rolling åˆ™å…¨ Rolling | é¿å…åˆ†å¸ƒåç§» | expert review |
| **P7** | **Category ç¼–ç ï¼šTrain æ‹Ÿåˆï¼Œå…¨å±€å¤ç”¨** | ç”¨ train çš„ categories æ˜ å°„ val/testï¼›æœªçŸ¥å½’ä¸º unknown | å¯å¤ç°æ€§ | expert review |

### 7.2 å¾…éªŒè¯åŸåˆ™

| # | åŸåˆ™ | åˆæ­¥å»ºè®® | éœ€è¦éªŒè¯ |
|---|---|---|---|
| ~~P8~~ | ~~LightGBM ä¼˜äº Linear~~ | ~~éçº¿æ€§æ•è·èƒ½åŠ›~~ | âŒ å·²å¦å®š |
| P9 | Rolling ä¼˜äº Frozenï¼ˆè‹¥çº¿ä¸Šæœ‰å®æ—¶ç‰¹å¾ï¼‰ | æ›´ç²¾ç¡®çš„å†å² | DG3 å†³ç­–å |
| P10 | Multi-task (EV + is_gift) | ç”¨å¯†é›†ä¿¡å·æ‰¶èµ·ç¨€ç–æ‰“èµ | åç»­è¿­ä»£ |
| P11 | MLP å¯èƒ½ä¼˜äº Linear | NN å¯èƒ½æ¯” Tree æ›´é€‚åˆç¨€ç–æ•°æ® | DG5 éªŒè¯ |
| **P12** | **ç•™å­˜ä½œä¸ºè§‚æµ‹ï¼Œä¸ä½œä¸ºé¢„æµ‹ç›®æ ‡** | AUC=0.57 éš¾ä»¥é¢„æµ‹ | exp_prediction_target_expansion |
| **P13** | **ç•™å­˜æ¨¡å‹åªèƒ½å½“æŠ¤æ ** | æ—  propensity/æ¢ç´¢æ¡¶ï¼Œæ— æ³•åš IPS æ ¡æ­£ | session/retention.md |
| **P14** | **ç”Ÿæ€ç”¨çº¦æŸï¼Œä¸ç”¨ç›‘ç£å­¦ä¹ ** | Gini æ˜¯å…¨å±€æŒ‡æ ‡ï¼Œéé€æ¡æ ‡ç­¾ | exp_prediction_target_expansion |

### 7.3 å·²å…³é—­æ–¹å‘

| æ–¹å‘ | å¦å®šè¯æ® | å…³é—­åŸå›  | æ•™è®­ |
|---|---|---|---|
| ~~Two-Stage for RevCap~~ | RevCap 45.66% < Direct 52.68% | Stage2 æ ·æœ¬å°‘è¯¯å·®å¤§ï¼Œä¹˜ p(x) æ”¾å¤§å™ªå£° | RevCap ç”¨ Directï¼›ç²¾ç»†æ’åºå¯ä¿ç•™ Two-Stage |
| ~~Three-Stage Whale-only~~ | RevCap 43.60% < Direct 52.68% | ä¸å¦‚ Direct raw Y | raw Y å·²éšå¼å­¦ä¼šæ‰¾ whale |
| ~~Log(1+Y) ç›®æ ‡~~ | RevCap -39.6% | å‹ç¼© whale ä¿¡å·ï¼ˆ10å…ƒ vs 1000å…ƒå·®è·å˜å°ï¼‰ | æ”¶å…¥åœºæ™¯ç”¨ raw Y |
| ~~å½“å‰ session watch_live_time~~ | Post-treatment | åŒ…å«æ‰“èµååœç•™æ—¶é—´ï¼Œclick æ—¶åˆ»ä¸å¯å¾— | ç”¨å†å²è§‚çœ‹å…ˆéªŒæ›¿ä»£ |
| ~~LightGBM å›å½’~~ | RevCap -3.1%~-14.5% | 98.5% ä¸º 0ï¼Œæ ‘æ¨¡å‹é¢„æµ‹ä¼—æ•° | **ç¨€ç–å›å½’ç”¨ Linearï¼Œä¸ç”¨ Tree** |
| ~~P(whale) åˆ†ç±»æ›¿ä»£å›å½’~~ | AUC=0.8533 ä½† RevCap=36.71% | åˆ†ç±»ä¸¢å¤±é‡‘é¢ä¿¡æ¯ï¼ˆ100å…ƒ=10000å…ƒï¼‰ | **RevCap ä»»åŠ¡ç”¨å›å½’ï¼Œä¸ç”¨åˆ†ç±»** |

### 7.4 âœ… å·²éªŒè¯é—®é¢˜ï¼ˆ2026-01-18ï¼‰

Expert Review è¯†åˆ«çš„ 4 ä¸ªæ½œåœ¨é—®é¢˜ï¼Œç»ä»£ç åˆ†æå’ŒéªŒè¯ï¼š

| é—®é¢˜ | çŠ¶æ€ | è¯´æ˜ |
|---|---|---|
| Train å†…éƒ¨ pair ç»Ÿè®¡è¢«æ¸…é›¶ | âœ… ä¸å­˜åœ¨ | Day-Frozen ä½¿ç”¨ `merge_asof(allow_exact_matches=False)`ï¼Œæ—  last_ts æ¸…é›¶é€»è¾‘ |
| User/Streamer å…¨å±€èšåˆæ³„æ¼ | âœ… ä¸å­˜åœ¨ | ä¸‰çº§ç‰¹å¾éƒ½ç”¨ cumsum + merge_asofï¼Œä¸¥æ ¼ `day < click_day` |
| pair_last_gift_gap å¯èƒ½ä¸ºè´Ÿ | âœ… ä¸é€‚ç”¨ | å½“å‰å®ç°æ—  last_gift_gap ç‰¹å¾ |
| Category ç¼–ç å„ split ç‹¬ç«‹ | âœ… **å·²ä¿®å¤** | Train æ‹Ÿåˆ categoriesï¼ŒVal/Test å¤ç”¨æ˜ å°„ï¼ŒOOVâ†’'unknown' |

**éªŒè¯ç»“æœ**ï¼š200/200 samples é€šè¿‡æ— æ³„æ¼éªŒè¯

---

## 8) æŒ‡é’ˆ

### æ ¸å¿ƒæ–‡ä»¶

| ç±»å‹ | è·¯å¾„ | è¯´æ˜ |
|---|---|---|
| ğŸ—ºï¸ **Roadmap** | `gift_EVpred_roadmap.md` | Decision Gates + MVP æ‰§è¡Œ |
| ğŸ“„ **Data Utils** | `data_utils.py` | **ç»Ÿä¸€æ•°æ®å¤„ç†å…¥å£ï¼ˆFinal v1.0ï¼‰** |
| ğŸ“Š **Metrics** | `metrics.py` | ç»Ÿä¸€è¯„ä¼°æ¨¡å— |
| ğŸ“Š **Final Result** | `results/baseline_ridge_final_20260119.json` | **æƒå¨æ•°å­—æ¥æº** |

### å®éªŒæŠ¥å‘Šï¼ˆå½“å‰æœ‰æ•ˆï¼‰

| æ—¥æœŸ | æŠ¥å‘Š | ç»“è®º |
|------|------|------|
| 01-19 | `exp/exp_baseline_ridge_20260119.md` | âœ… **Final Baseline: 51.4%** (Last-Touch å½’å› ) |
| 01-19 | `exp/exp_metrics_20260119.md` | âœ… **Metrics v2.2 æŒ‡æ ‡ä½“ç³»å®Œæ•´æ‰‹å†Œ** |

### Slides

| æ—¥æœŸ | Slides | å†…å®¹ |
|------|--------|------|
| 01-20 | `slide/slides_baseline_ridge_20260119.md` | Baseline v2.2 è¯„ä¼°ï¼šSample 35Ã—, User 12Ã— |
| 01-20 | `slide/slides_metrics_v22_20260119.md` | 7 å±‚ 38 æŒ‡æ ‡ä½“ç³» |

### çŸ¥è¯†å¡ç‰‡

| å¡ç‰‡ | æ ¸å¿ƒå†…å®¹ |
|------|---------|
| `card/card_baseline.md` | Final Baseline é…ç½® |
| `card/card_metric.md` | RevCap æŒ‡æ ‡ä½“ç³» |
| `card/card_data.md` | æ•°æ®å¤„ç†è§„èŒƒ |
| `card/card_label_duplicate.md` | Over-Attribution ä¿®å¤ |
| `card/card_pair_hist_analysis.md` | pair_hist æ— æ³„æ¼éªŒè¯ |

### å½’æ¡£

| è·¯å¾„ | è¯´æ˜ |
|------|------|
| `exp/archive_leaky/` | æœ‰æ³„æ¼çš„æ—§å®éªŒï¼ˆå‹¿å‚è€ƒï¼‰ |
| `exp/archive_last_touch/` | Last-Touch å‰çš„æ—§å®éªŒï¼ˆä¸€ä¸ª gift å½’å› å¤šä¸ª clickï¼‰ |

---

## 9) å˜æ›´æ—¥å¿—

| æ—¥æœŸ | å˜æ›´ | å½±å“ |
|---|---|---|
| 2026-01-18 | åˆ›å»º Day-Frozen æ— æ³„æ¼æ¡†æ¶ | å¯ä¿¡å®éªŒåŸºç¡€ |
| 2026-01-18 | Direct vs Two-Stage baseline | åˆå§‹ baseline |
| 2026-01-18 | Three-Stage Whale-only å®éªŒ | RevCap=43.60%ï¼Œä¸å¦‚é¢„æœŸ |
| 2026-01-18 | **Raw Y vs Log Y å®éªŒ** | **RevCap=52.68%ï¼ˆ+39.6%ï¼‰ï¼Œå½“å‰æœ€ä¼˜** |
| 2026-01-18 | Expert Review æ•´åˆ | æ–°å¢ M7-M11 æ–¹æ³•è®ºæ´è§ï¼›æ˜ç¡® Frozen vs Rolling åè®® trade-off |
| 2026-01-18 | **P0-Tech éªŒè¯é€šè¿‡** | 3 ä¸ªé—®é¢˜ä¸å­˜åœ¨ï¼ˆDay-Frozen è®¾è®¡æ­£ç¡®ï¼‰ï¼Œ1 ä¸ªå·²ä¿®å¤ï¼ˆCategory ç¼–ç ï¼‰ï¼›200/200 éªŒè¯é€šè¿‡ |
| 2026-01-18 | **Alpha Sweep** | Ridge alpha 0.001~1000 æ— å½±å“ï¼Œç¡®è®¤ Linear ç“¶é¢ˆ 52.60% |
| 2026-01-18 | **LightGBM å®éªŒ** | âŒ å›å½’å¤±è´¥ï¼ˆ-3.1%~-14.5%ï¼‰ï¼ŒTree ä¸é€‚åˆç¨€ç–æ•°æ® |
| 2026-01-18 | **åˆ†ç±» vs å›å½’æ´è§** | ğŸ”‘ åˆ†ç±»ä¸¢å¤±é‡‘é¢ä¿¡æ¯ï¼ŒAUCâ‰ RevCapï¼›æ–°å¢ K7, K8, E8-E10 |
| 2026-01-18 | **ä¸‰å±‚æŒ‡æ ‡ä½“ç³»** | æ–°å¢ Â§10 è¯†åˆ«å±‚/ä¼°å€¼å±‚/åˆ†é…å±‚æŒ‡æ ‡æ¡†æ¶ |
| 2026-01-19 | **æ–°å®éªŒç«‹é¡¹** | 3 ä¸ªå®éªŒï¼šæŒ‡æ ‡è½åœ°(01) + å†å²è§‚çœ‹å…ˆéªŒ(02) + æ ·æœ¬åŠ æƒå›å½’(03) |
| 2026-01-19 | **MVP-3.1 æŒ‡æ ‡ä½“ç³»è½åœ°å®Œæˆ** | RevCap@1%=52.6%, CV=10.8%, ç»Ÿä¸€æŠ¥å‘Šæ¨¡æ¿å·²è½åœ° |
| 2026-01-19 | **MVP-3.2 Baseline ç¡®ç«‹** | ä¿å­˜æ¨¡å‹/ç‰¹å¾/é…ç½®ï¼Œmetrics.py + card_baseline.md |
| 2026-01-19 | **ğŸ”‘ Cold Start æ•ˆåº”å‘ç°** | Train RevCap=29.4% << Test=52.6% ä¸æ˜¯æ³„æ¼ï¼Œæ˜¯å†å²ç‰¹å¾ç§¯ç´¯ä¸è¶³ï¼›æ–°å¢ K9, E11 |
| 2026-01-19 | **ğŸ”´ Over-Attribution Bug ä¿®å¤** | 8.43% gift è¢«å¤šæ¡ click è®¡å…¥ â†’ Last-Touch ä¿®å¤ï¼›Label/Gift ratio ä» 116.78% â†’ 92.37%ï¼›æ–°å¢ K10, E12 |
| 2026-01-19 | **ğŸ”‘ å½’å› çª—å£åˆ†æ** | 98.2% gift åœ¨ click åŒæ¯«ç§’å†…å‘ç”Ÿï¼›1min çª—å£è¦†ç›– 92.6%ï¼›1min vs 60min å¯¹ RevCap æ— å½±å“ï¼›æ–°å¢ K11 |
| 2026-01-19 | **ğŸ”‘ Strict æ¨¡å¼ä¸Šçº¿** | Drop å¿«ç…§ç‰¹å¾ï¼ˆfans/accu_*ï¼‰ï¼Œé¿å… KuaiLive May 25 å¿«ç…§æ³„æ¼ï¼›20 ç‰¹å¾ vs 31 ç‰¹å¾ï¼›æ–°å¢ K12 |
| 2026-01-19 | **ğŸ”‘ data_utils.py Final ç‰ˆæœ¬** | gift_id å»é‡ + 1min é»˜è®¤çª—å£ + Strict é»˜è®¤æ¨¡å¼ + orphan breakdown æ—¥å¿— |
| 2026-01-19 | **Final Baseline (Strict)** | RevCap@1%=51.4%, CV=9.4%ï¼ˆé¦–æ¬¡ <10%ï¼‰ï¼Œ95% CI [47.2%, 54.4%] |
| 2026-01-19 | **ğŸ”‘ Strict vs Benchmark å¯¹æ¯”** | 11 ä¸ªå¿«ç…§ç‰¹å¾åªå  22.6% ç³»æ•°æƒé‡ï¼›RevCap å®Œå…¨ç›¸åŒï¼›æ–°å¢ E13 |
| 2026-01-19 | **ğŸ”‘ pair_hist æ·±åº¦åˆ†æ** | éªŒè¯æ— æ³„æ¼ï¼ˆ10/10 é€šè¿‡ï¼‰ï¼›å»æ‰å RevCap -12.9ppï¼›å‘ç°é¦–æ¬¡æ‰“èµé—®é¢˜ï¼ˆ56% æ”¶å…¥ä½† RevCap 29.6%ï¼‰ï¼›æ–°å¢ E14, E15 |
| 2026-01-19 | **ğŸ“¦ Final Baseline v1.0 å‘å¸ƒ** | RevCap@1%=51.4%, CV=9.4%; 20 ç‰¹å¾ (Strict); 1min çª—å£; Last-Touch; æ–‡æ¡£æ•´ç†å®Œæˆ |
| 2026-01-19 | **ğŸ”´ é¢„æµ‹ç›®æ ‡æ‰©å±•ç«‹é¡¹** | Q2.4 æ–°å¢ï¼›ä»"é¢„æµ‹ gift"æ‰©å±•åˆ°"é¢„æµ‹è¡ŒåŠ¨åæœ"ï¼ˆçŸ­æœŸæ”¶ç›Š + ç•™å­˜ + ç”Ÿæ€ï¼‰ |
| 2026-01-19 | **ğŸ”‘ é¢„æµ‹ç›®æ ‡æ‰©å±•å®Œæˆ** | ç•™å­˜ AUC=0.57ï¼ˆâŒ ä¸å¯é¢„æµ‹ï¼‰ï¼›å‘ç°æ‰“èµä¸ç•™å­˜è´Ÿç›¸å…³ï¼ˆ-10.3ppï¼‰ï¼›æ”¶å…¥ Gini=0.93ï¼›æ–°å¢ E16-E18 |
| 2026-01-19 | **âŒ æ ·æœ¬åŠ æƒå›å½’å®éªŒ** | Î±=0 æœ€ä¼˜ï¼ŒÎ±>0 æ€§èƒ½ä¸‹é™ï¼›Î±=1.0 å´©æºƒè‡³ 24.4%ï¼›ç­‰æƒå›å½’å·²è¶³å¤Ÿï¼›æ–°å¢ E19 |
| 2026-01-19 | **âš ï¸ å†å²è§‚çœ‹å…ˆéªŒå®éªŒ** | RevCap@1% +0.01ppï¼Œç³»æ•°å·® 48 å€ï¼›è§‚çœ‹è¢«æ‰“èµéšå«ï¼Œä¸åŠ å…¥ï¼›æ–°å¢ E20 |
| 2026-01-19 | **ğŸš€ metrics.py v2.1** | 4 ä¸ª P0 å†³ç­–æŒ‡æ ‡å®ç°ï¼šMisallocation Cost / Capture AUC / PSI Drift / Diversity |
| 2026-01-20 | **ğŸš€ metrics.py v2.2** | å£å¾„ä¿®è®¢ï¼šé‡‘é¢/æ¯”ä¾‹åŒç‰ˆæœ¬ã€Regret å‘½åè§„èŒƒã€nAUC âˆˆ [0,1]ã€Overload æ‹†åˆ† |
| 2026-01-20 | **ğŸ“Š Baseline v2.2 è¯„ä¼°** | WRecLift=34.6Ã—ï¼ˆSampleï¼‰ã€WhaleUserPrec=72.6%ï¼ˆUserï¼‰ã€PSI=0.155ï¼ˆå¯ä¸Šçº¿ï¼‰ |
| 2026-01-20 | **ğŸ“‘ Slides ç”Ÿæˆ** | slides_baseline_ridge + slides_metrics_v22 |

---

## 10) ğŸ“ ä¸‰å±‚æŒ‡æ ‡ä½“ç³»ï¼ˆ2026-01-19 æ›´æ–°ï¼‰

> åŸºäºä¸“å®¶å»ºè®®ï¼Œå»ºç«‹"é¢„æµ‹ â†’ å†³ç­– â†’ çº¦æŸ â†’ é•¿æœŸ"å…¨é“¾è·¯è¯„ä¼°å£å¾„

### 10.1 è¯†åˆ«å±‚ï¼ˆFind Whales / æ’åºè´¨é‡ï¼‰

| æŒ‡æ ‡ | å®šä¹‰ | çŠ¶æ€ | å½“å‰å€¼ |
|------|------|------|--------|
| **RevCap@K** | Top K% æ•è·æ”¶å…¥å æ¯” | âœ… å·²å®ç° | @1%=51.4% |
| **Normalized RevCap@K** | RevCap / Oracle | âœ… å·²å®ç° | @1%=51.6% |
| **Capture Curve AUC** | âˆ«â‚€^Î± RevCap(k) dk | âœ… å·²å®ç° | - |
| Whale Recall@K | yâ‰¥P90 çš„å¬å› | âœ… å·²å®ç° | @1%=34.6% |
| Whale Precision@K | TopK é‡Œ whale æ¯”ä¾‹ | âœ… å·²å®ç° | @1%=5.0% |
| **Gift Rate@K** | TopK é‡Œæœ‰æ‰“èµçš„æ¯”ä¾‹ | âœ… å·²å®ç° | @1%~35% |
| Avg Revenue@K | TopK äººå‡æ‰“èµ | âœ… å·²å®ç° | @1%=78.2å…ƒ |
| NDCG@K (å¤š K) | æ’åºè´¨é‡ | â³ å¯é€‰ | @100 å¾…è¡¥ |

> **Capture Curve AUC** é¿å…"åªä¼˜åŒ– 1% å¯¼è‡´ 5%/10% å´©"çš„è¿‡æ‹Ÿåˆ

### 10.2 ä¼°å€¼å±‚ï¼ˆPredict EV / æ ¡å‡†ä¸æˆæœ¬ï¼‰

| æŒ‡æ ‡ | å®šä¹‰ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| **Tail Calibration** | Sum(pred)/Sum(actual) æŒ‰æ¡¶ | âœ… å·²å®ç° | å¤´éƒ¨æ ¡å‡† |
| **DW-ECE** | é‡‘é¢åŠ æƒ ECE | ğŸ”´ å¾…å®ç° | å¯¹é‡å°¾æ›´æ•æ„Ÿ |
| **Misallocation Cost** | Oracle@K - Achieved@K | âœ… å·²å®ç° | é”™åˆ†ä»£ä»· |
| **Opportunity Cost** | ç¨€ç¼ºå¤§å“¥åˆ†é”™çš„æœºä¼šæˆæœ¬ | âœ… å·²å®ç° | å†³ç­–æœ€å…³é”® |
| Over/Under-estimation | é«˜ä¼° vs ä½ä¼°æ¯”ä¾‹ | â³ å¯é€‰ | - |
| Probability ECE | P(gift) æ¦‚ç‡æ ¡å‡† | âœ… å·²å®ç° | äºŒåˆ†ç±»æ ¡å‡† |

> **Misallocation Cost**ï¼šåŒæ · RevShare@1% çš„ä¸¤ä¸ªæ¨¡å‹ï¼Œé”™åˆ†ä»£ä»·å¯èƒ½å·® 2Ã—

### 10.3 ç¨³å®šæ€§ä¸å¯ä¸Šçº¿æ€§ï¼ˆTemporal + Driftï¼‰

| æŒ‡æ ‡ | å®šä¹‰ | çŠ¶æ€ | å½“å‰å€¼ |
|------|------|------|--------|
| **Temporal Stability** | æŒ‰å¤© RevCap å‡å€¼Â±æ ‡å‡†å·® | âœ… å·²å®ç° | CV=9.4% |
| **95% CI** | Bootstrap ç½®ä¿¡åŒºé—´ | âœ… å·²å®ç° | [47.2%, 54.4%] |
| **PSI / Drift** | Train vs Test é¢„æµ‹åˆ†å¸ƒæ¼‚ç§» | âœ… å·²å®ç° | - |
| KL Divergence | åˆ†å¸ƒæ¼‚ç§»é‡åŒ– | âœ… å·²å®ç° | - |
| æŒ‰å°æ—¶ç¨³å®šæ€§ | æ›´ç»†ç²’åº¦æ—¶é—´æ³¢åŠ¨ | â³ å¯é€‰ | - |

> **PSI/Drift**ï¼šç³»ç»Ÿä¾èµ–å†å²äº¤äº’ç‰¹å¾ï¼Œå†·å¯åŠ¨æ¯”ä¾‹é«˜æ—¶æ¼‚ç§»é£é™©å¤§

### 10.4 ç”Ÿæ€æŠ¤æ ï¼ˆEcosystem Guardrailsï¼‰

| æŒ‡æ ‡ | å®šä¹‰ | çŠ¶æ€ | å½“å‰å€¼ |
|------|------|------|--------|
| **Streamer Gini** | ä¸»æ’­æ”¶å…¥é›†ä¸­åº¦ | âœ… å·²å®ç° | 0.926 |
| **Top10 Share** | Top 10% ä¸»æ’­æ”¶å…¥å æ¯” | âœ… å·²å®ç° | ~99% |
| **Tail Coverage** | é•¿å°¾ä¸»æ’­è¦†ç›–ç‡ | âœ… å·²å®ç° | - |
| **Cold Start Coverage** | æ–°ä¸»æ’­è¦†ç›–ç‡ | âœ… å·²å®ç° | - |
| **Diversity / Entropy** | exp(entropy(streamer_id)) | âœ… å·²å®ç° | - |
| Overload Rate | é«˜ä»·å€¼ç”¨æˆ·è¿‡è½½ | âœ… å·²å®ç° | - |
| **Fairness Gap** | åˆ‡ç‰‡é—´æ”¶ç›Šå·®è· | ğŸŸ¡ å¾…å®ç° | - |

> **Diversity/Entropy** æ¯” Gini æ›´çµæ•ï¼Œèƒ½æ•æ‰"è¦†ç›–å¤šä½†ä»é›†ä¸­"çš„æƒ…å†µ

### 10.5 åˆ†é…å±‚ï¼ˆAllocation / OPEï¼‰

| æŒ‡æ ‡ | å®šä¹‰ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| Total Revenue | âˆ‘_s V_s | â³ Gate-3 | çº¿æ€§æ”¶ç›Š |
| Concave Revenue | âˆ‘_s g_s(V_s) | â³ Gate-3 | å‡¹æ”¶ç›Š |
| **OPE (IPS/DR)** | åäº‹å®ä¼°è®¡ | â³ Gate-3 | éœ€è¦ propensity |
| **ESS** | æœ‰æ•ˆæ ·æœ¬é‡ | â³ Gate-3 | é¿å… OPE å¹»è§‰ |
| Cap Violation Rate | ä¸»æ’­æ‰¿æ¥ä¸Šé™è¿å | â³ Gate-3 | çº¦æŸæ»¡è¶³ç‡ |
| Min Exposure Sat. | æœ€ä½æ›å…‰æ»¡è¶³ç‡ | â³ Gate-3 | å…¬å¹³çº¦æŸ |

### 10.6 æŒ‡æ ‡å®ç°çŠ¶æ€ï¼ˆ2026-01-19 æ›´æ–°ï¼‰

| ä¼˜å…ˆçº§ | æŒ‡æ ‡ | å‡½æ•°å | çŠ¶æ€ |
|--------|------|--------|------|
| ~~ğŸ”´ P0~~ | **Misallocation Cost** | `compute_misallocation_cost()` | âœ… å·²å®ç° |
| ~~ğŸ”´ P0~~ | **Capture Curve AUC** | `compute_capture_auc()` | âœ… å·²å®ç° |
| ~~ğŸ”´ P0~~ | **PSI / Drift** | `compute_drift()` | âœ… å·²å®ç° |
| ~~ğŸ”´ P0~~ | **Diversity / Entropy** | `compute_diversity()` | âœ… å·²å®ç° |
| ğŸŸ¡ P1 | DW-ECE | `compute_dw_ece()` | â³ å¾…å®ç° |
| ğŸŸ¡ P1 | Fairness Gap | `compute_fairness_gap()` | â³ å¾…å®ç° |

> **v2.1 æ›´æ–°**ï¼š4 ä¸ª P0 å†³ç­–æ ¸å¿ƒæŒ‡æ ‡å·²å…¨éƒ¨å®ç°ï¼Œé›†æˆåˆ° `evaluate_model()` ä¸»å‡½æ•°

### 10.7 åœ¨çº¿æŠ¤æ 

| ç±»åˆ« | æŒ‡æ ‡ |
|------|------|
| æ”¶ç›Š | Revenue/DAU, ARPPU |
| ç•™å­˜ | D1/D7 ç•™å­˜ç‡ï¼ˆæ‰“èµç”¨æˆ· -10.3ppï¼‰ |
| ç”Ÿæ€ | Gini å˜åŒ–, ä¸­å°ä¸»æ’­è¦†ç›– |
| é£æ§ | é€€å‡ºç‡, æŠ•è¯‰ç‡ |

> è¯¦è§ï¼š[exp_metrics_framework_20260118.md](./exp/exp_metrics_framework_20260118.md)

---

<details>
<summary><b>é™„å½•ï¼šæœ¯è¯­è¡¨</b></summary>

| æœ¯è¯­ | å®šä¹‰ |
|---|---|
| EV | Expected Valueï¼ŒæœŸæœ›æ‰“èµé‡‘é¢ |
| RevCap@K | Revenue Capture @K%ï¼ŒTop-K% é¢„æµ‹æ•è·çš„å®é™…æ”¶å…¥å æ¯” |
| Whale | å¤§é¢æ‰“èµç”¨æˆ·ï¼ˆå¦‚ â‰¥100å…ƒï¼‰ |
| Day-Frozen | å†å²ç‰¹å¾åªç”¨ `day < current_day` çš„æ•°æ® |
| Rolling | å†å²ç‰¹å¾ç”¨ `gift_ts < click_ts` çš„æ•°æ® |

</details>
