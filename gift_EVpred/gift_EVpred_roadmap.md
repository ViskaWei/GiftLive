# ğŸ—ºï¸ Gift_EVpred Roadmap
> **Name:** Gift EV Model Roadmap | **ID:** `EXP-20260118-gift_EVpred-roadmap`
> **Topic:** `gift_EVpred` | **Phase:** 1 (Day-Frozen Baseline å·²å»ºç«‹)
> **Author:** Viska Wei | **Date:** 2026-01-18 | **Status:** âœ…

```
ğŸ’¡ å½“å‰é˜¶æ®µç›®æ ‡ï¼šåŸºäº Day-Frozen æ— æ³„æ¼ Baseline è¿›è¡Œæ¨¡å‹ä¼˜åŒ–
Gate-0ï¼šâœ… å·²é€šè¿‡ - Day-Frozen ç‰¹å¾æ— æ³„æ¼ï¼Œ200/200 éªŒè¯é€šè¿‡
Gate-1ï¼šâœ… å·²é€šè¿‡ - Two-Stage RevCap@1% = 44.42% > Direct 37.73%
```

---

## ğŸŸ¢ Gate-0/Gate-1 ç»“æœï¼ˆ2026-01-18ï¼‰

> **Gate-0 é€šè¿‡**ï¼šDay-Frozen ç‰¹å¾æ— æ³„æ¼ï¼ˆ200/200 éªŒè¯é€šè¿‡ï¼‰
> **Gate-1 æ›´æ–°**ï¼š**Direct + raw Y** åœ¨ Revenue Capture @1% ä¸Šæœ€ä¼˜ï¼ˆ52.68%ï¼‰

| æŒ‡æ ‡ | Direct log Y | Direct raw Y | è¯´æ˜ |
|------|--------------|--------------|------|
| Spearman | 0.1061 | 0.0666 | Trade-off |
| Top-1% Gift Rate | 24.05% | 11.1% | raw Y æ‰¾ whale |
| **Revenue Capture @1%** | 37.73% | **52.68%** | **+39.6%** |
| Revenue Capture @5% | 59.84% | - | - |

---

## ğŸ”— Related Files

| Type | File |
|------|------|
| ğŸ§  Hub | `gift_EVpred_hub.md` |
| ğŸ“— Baseline Report | `exp/exp_baseline_day_frozen_20260118.md` |
| ğŸ“„ Data Utils | `data_utils.py` |
| ğŸ—ƒï¸ Archive (Leaky) | `exp/archive_leaky/` |

---

# 1. ğŸš¦ Decision Gates

## 1.1 Gate è¿›åº¦

| Gate | çŠ¶æ€ | ç»“æœ | è¯´æ˜ |
|------|------|------|------|
| **Gate-0** | âœ… é€šè¿‡ | 200/200 | Day-Frozen ç‰¹å¾æ— æ³„æ¼éªŒè¯ |
| **Gate-1** | âœ… é€šè¿‡ | 52.60% | Direct + raw Y æœ€ä¼˜ |
| **Gate-2** | âŒ å¤±è´¥ | -14.5% | LightGBM åŠ£äº Ridge |
| Gate-3 | â³ è¿œæœŸ | - | æ¨¡æ‹Ÿå™¨éªŒè¯ |

## 1.2 Gate å®šä¹‰

### Gate-0: æ— æ³„æ¼éªŒè¯ ã€âœ… å·²é€šè¿‡ã€‘

| é¡¹ | å†…å®¹ |
|----|------|
| **éªŒè¯** | Day-Frozen ç‰¹å¾æ˜¯å¦çœŸçš„æ— æ³„æ¼ |
| **æ–¹æ³•** | å¯¹æ¯ä¸ª clickï¼ŒéªŒè¯å†å²ç‰¹å¾åªç”¨ `day < click_day` çš„æ•°æ® |
| **ç»“æœ** | âœ… 200/200 æ ·æœ¬éªŒè¯é€šè¿‡ |

### Gate-1: Direct vs Two-Stage ã€âœ… å·²é€šè¿‡ã€‘

| é¡¹ | å†…å®¹ |
|----|------|
| **éªŒè¯** | å“ªç§å»ºæ¨¡æ–¹æ¡ˆåœ¨ Revenue Capture ä¸Šæ›´ä¼˜ |
| **ç»“æœ** | âœ… Two-Stage 44.42% > Direct 37.73%ï¼ˆ+17.8%ï¼‰ |
| **ç»“è®º** | æ¨è Two-Stage ä½œä¸ºåç»­ baseline |

### Gate-2: æ¨¡å‹å‡çº§ ã€âŒ å¤±è´¥ã€‘

| é¡¹ | å†…å®¹ |
|----|------|
| **éªŒè¯** | LightGBM æ˜¯å¦ä¼˜äº Linear æ¨¡å‹ |
| **ç»“æœ** | âŒ LightGBM RevCap@1%=44.97% < Ridge 52.60%ï¼ˆ-14.5%ï¼‰ |
| **åŸå› ** | 98.5% æ ·æœ¬ target=0ï¼Œæ ‘æ¨¡å‹å€¾å‘é¢„æµ‹ä¼—æ•° |
| **ç»“è®º** | Linear æ¨¡å‹ï¼ˆRidgeï¼‰ä»æ˜¯å½“å‰æœ€ä¼˜ |

### Gate-3: æ¨¡æ‹Ÿå™¨éªŒè¯

| é¡¹ | å†…å®¹ |
|----|------|
| **éªŒè¯** | æ¨¡æ‹Ÿå™¨èƒ½å¦ç”¨äºç­–ç•¥è¯„ä¼°ï¼ˆOPE/åˆ†é…ä¼˜åŒ–ï¼‰ |
| **çŠ¶æ€** | â³ è¿œæœŸ |

---

# 2. ğŸ“‹ MVP åˆ—è¡¨

## 2.1 æ€»è§ˆ

| MVP | åç§° | Gate | çŠ¶æ€ | æŠ¥å‘Š |
|-----|------|------|------|------|
| **1.0** | **Day-Frozen Baseline** | **Gate-0/1** | **âœ… å®Œæˆ** | [Link](./exp/exp_baseline_day_frozen_20260118.md) |
| **1.1** | **Three-Stage (Whale-only)** | Gate-1 | âœ… å®Œæˆ | [Link](./exp/exp_three_stage_20260118.md) |
| **1.2** | **Raw Y vs Log Y** | Gate-1 | **âœ… å®Œæˆ** | [Link](./exp/exp_raw_vs_log_20260118.md) |
| **2.0** | **LightGBM + raw Y** | Gate-2 | **âŒ å¤±è´¥** | [Link](./exp/exp_lightgbm_raw_y_20260118.md) |
| **3.0** | **ä¸‰å±‚æŒ‡æ ‡ä½“ç³»è®¾è®¡** | - | **âœ… å®Œæˆ** | [Link](./exp/exp_metrics_framework_20260118.md) |
| 3.1 | å†å²è§‚çœ‹å…ˆéªŒç‰¹å¾ | - | â³ å¾…æ‰§è¡Œ | - |
| 3.2 | æ ·æœ¬åŠ æƒå›å½’ | - | â³ å¾…æ‰§è¡Œ | - |
| 4.0 | åˆ†é… MVP | Gate-4 | â³ è¿œæœŸ | - |
| 5.0 | æ¨¡æ‹Ÿå™¨ V1 | Gate-5 | â³ è¿œæœŸ | - |

## 2.2 ä¸‹ä¸€æ­¥ä¼˜å…ˆçº§

| ä¼˜å…ˆçº§ | ä»»åŠ¡ | é¢„æœŸæ”¶ç›Š | éªŒæ”¶æ ‡å‡† |
|--------|------|----------|----------|
| ~~ğŸ”´ P0-Tech~~ | ~~ä¿®å¤ data_utils.py~~ | âœ… **å·²éªŒè¯é€šè¿‡** | 3 ä¸ªé—®é¢˜ä¸å­˜åœ¨ï¼Œ1 ä¸ªå·²ä¿®å¤ |
| ~~ğŸ”´ P0-Model~~ | ~~LightGBM + raw Y~~ | âŒ **å¤±è´¥**ï¼ˆ-14.5%ï¼‰ | æ ‘æ¨¡å‹ä¸é€‚åˆç¨€ç–æ•°æ® |
| ğŸ”´ **P0-Feature** | å†å²è§‚çœ‹å…ˆéªŒç‰¹å¾ | æ›¿ä»£ watch_live_time | RevCap > 54% |
| ğŸ”´ **P0-Metrics** | ä¸‰å±‚æŒ‡æ ‡ä½“ç³»æ ‡å‡†åŒ– | ç»Ÿä¸€è¯„ä¼°å£å¾„ | æ‰€æœ‰å®éªŒä½¿ç”¨ |
| ğŸŸ¡ **P1-Tail** | æ ·æœ¬åŠ æƒå›å½’ `w_i=(1+y_i)^Î±` | å¤´éƒ¨æ•è·â†‘ | RevCap > 55% |
| ğŸŸ¡ P1-Whale | é’ˆå¯¹ whale çš„ç‰¹å¾ | æ›´å¥½åŒºåˆ†å¤§é¢æ‰“èµè€… | RevCap > 54% |
| ğŸŸ¢ P2-Model | å°è¯• MLP | éçº¿æ€§ï¼ˆæ¯”æ ‘æ›´é€‚åˆç¨€ç–ï¼‰ | RevCap > 55% |
| ğŸŸ¢ **P3-Alloc** | åˆ†é… MVP | è´ªå¿ƒ vs å‡¹æ”¶ç›Šè´ªå¿ƒ | æ€»æ”¶ç›Š+Gini å¯¹æ¯” |

---

# 3. ğŸ”§ MVP è§„æ ¼

## MVP-1.0: Day-Frozen Baseline ã€âœ… å®Œæˆã€‘

| é¡¹ | é…ç½® |
|----|------|
| **ç›®æ ‡** | å»ºç«‹æ— æ³„æ¼ EV é¢„æµ‹ baseline |
| **æ•°æ®** | Click-levelï¼Œ4.9M æ ·æœ¬ï¼Œ7-7-7 æŒ‰å¤©åˆ‡åˆ† |
| **ç‰¹å¾** | 31 ä¸ª Day-Frozen ç‰¹å¾ï¼ˆpair/user/streamer å†å² + profile + timeï¼‰ |
| **æ¨¡å‹** | Direct (Ridge) + Two-Stage (LR + Ridge) |
| **ä¸»æŒ‡æ ‡** | Revenue Capture @K |
| **ç»“æœ** | âœ… Two-Stage RevCap@1% = 44.42% |

**å…³é”®è®¾è®¡**ï¼š
- Day-Frozenï¼šå†å²ç‰¹å¾åªç”¨ `day < current_day` çš„æ•°æ®
- `pd.merge_asof(..., allow_exact_matches=False)` å®ç°ä¸¥æ ¼ `<` è¯­ä¹‰
- Val/Test ä½¿ç”¨ Train ç»“æŸæ—¶çš„ç»Ÿè®¡ï¼ˆFrozen Lookupï¼‰

## MVP-1.1: Three-Stage (Whale-only) ã€âœ… å®Œæˆã€‘

| é¡¹ | é…ç½® |
|----|------|
| **ç›®æ ‡** | ä¸“æ³¨é¢„æµ‹"è¶…çº§å¤§å“¥"ï¼ˆWhaleï¼‰ï¼Œæå‡ Revenue Capture |
| **æ•°æ®** | åŒ MVP-1.0ï¼ŒClick-levelï¼Œ7-7-7 æŒ‰å¤©åˆ‡åˆ† |
| **ç­–ç•¥** | Whale-only: Score = P(whale) Ã— E[whale] |
| **é˜ˆå€¼** | P90 = 100å…ƒï¼ˆtop 10% giftersï¼‰ |
| **ç»“æœ** | **RevCap@1% = 43.60%**ï¼Œæ¯” Two-Stage æå‡ **36.2%** |

**æ ¸å¿ƒå‘ç°**ï¼š
- æ ‡å‡† Three-Stage åè€Œä¸å¦‚ Two-Stage
- Whale-only ç­–ç•¥å®Œèƒœï¼šä¸“æ³¨é¢„æµ‹è¶…çº§å¤§å“¥
- é˜ˆå€¼è¶Šé«˜æ•ˆæœè¶Šå¥½ï¼ˆP50 < P60 < ... < P90ï¼‰

## MVP-1.2: Raw Y vs Log Y ã€âœ… å®Œæˆã€‘

| é¡¹ | é…ç½® |
|----|------|
| **ç›®æ ‡** | å¯¹æ¯” raw Y å’Œ log(1+Y) é¢„æµ‹ç›®æ ‡ |
| **æ•°æ®** | åŒ MVP-1.0ï¼ŒClick-levelï¼Œ7-7-7 æŒ‰å¤©åˆ‡åˆ† |
| **æ¨¡å‹** | Direct (Ridge) + Two-Stage (LR + Ridge) |
| **ç»“æœ** | **Direct + raw Y: RevCap@1% = 52.68%**ï¼ˆ+39.6%ï¼‰ |

**æ ¸å¿ƒå‘ç°**ï¼š
- Raw Y æ¯” log(1+Y) åœ¨ RevCap@1% ä¸Šæå‡ **39.6%**
- Spearman å’Œ RevCap å‘ˆè´Ÿç›¸å…³ï¼ˆTrade-offï¼‰
- Log å˜æ¢å‹ç¼© whale ä¿¡å·ï¼ŒæŸå¤±æ”¶å…¥æ•è·èƒ½åŠ›
- ä¸šç•Œæ¨èï¼šæ”¶å…¥æœ€å¤§åŒ–åœºæ™¯ä½¿ç”¨ raw Y

## MVP-2.0: LightGBM + Raw Y ã€âŒ å¤±è´¥ã€‘

| é¡¹ | é…ç½® |
|----|------|
| **ç›®æ ‡** | ç”¨ LightGBM æ›¿ä»£ Linear æ¨¡å‹ |
| **é¢„æœŸ** | éçº¿æ€§ç‰¹å¾äº¤äº’å¯èƒ½æå‡ RevCap |
| **ç»“æœ** | âŒ LightGBM RevCap@1%=44.97% < Ridge 52.60%ï¼ˆ-14.5%ï¼‰ |

**å¤±è´¥åŸå› **ï¼š
- 98.5% æ ·æœ¬ target=0ï¼Œæ ‘æ¨¡å‹å€¾å‘é¢„æµ‹ä¼—æ•°ï¼ˆ0ï¼‰
- Best iteration=1ï¼Œæ¨¡å‹ç«‹å³è§¦å‘ early stopping
- æ ‘æ¨¡å‹çš„é˜¶è·ƒå‡½æ•°é¢„æµ‹åœ¨æ’åºä»»åŠ¡ä¸ŠåŠ£äºçº¿æ€§æ¨¡å‹çš„å¹³æ»‘é¢„æµ‹

---

# 4. ğŸ“Š è¿›åº¦è¿½è¸ª

## 4.1 ç»“è®ºå¿«ç…§

| MVP | ç»“è®º | å…³é”®æŒ‡æ ‡ | çŠ¶æ€ |
|-----|------|---------|------|
| **1.0** | Day-Frozen Baseline | RevCap@1%=37.73% (Direct log Y) | âœ… å®Œæˆ |
| **1.1** | Whale-only ç­–ç•¥ | RevCap@1%=43.60% â†’ 39.48% (raw Y) | âœ… å®Œæˆ |
| **1.2** | **Raw Y vs Log Y** | **RevCap@1%=52.60% (+39.6%)** | âœ… å®Œæˆ |
| **2.0** | LightGBM + raw Y | RevCap@1%=44.97% (-14.5%) | âŒ å¤±è´¥ |

## 4.2 æ—¶é—´çº¿

| æ—¥æœŸ | äº‹ä»¶ | å½±å“ |
|------|------|------|
| 2026-01-18 | åˆ›å»º Day-Frozen æ— æ³„æ¼æ¡†æ¶ | è§£å†³æ•°æ®æ³„æ¼é—®é¢˜ |
| 2026-01-18 | å»ºç«‹ Direct vs Two-Stage baseline | åŸºå‡† 37.73% |
| 2026-01-18 | å½’æ¡£æ‰€æœ‰æœ‰æ³„æ¼çš„æ—§å®éªŒ | 24 ä¸ªå®éªŒç§»è‡³ archive_leaky/ |
| 2026-01-18 | Three-Stage Whale-only å®éªŒ | RevCap@1% = 43.60% (log Y) |
| 2026-01-18 | **Raw Y vs Log Y å®éªŒ** | **RevCap@1% = 52.60%ï¼ˆå½“å‰æœ€ä¼˜ï¼‰** |
| 2026-01-18 | Expert Review æ•´åˆ | è¯†åˆ« 4 ä¸ªæ½œåœ¨é—®é¢˜ï¼›æ˜ç¡® Frozen vs Rolling åè®® trade-off |
| 2026-01-18 | **P0-Tech éªŒè¯é€šè¿‡** | 3 ä¸ªé—®é¢˜ä¸å­˜åœ¨ï¼ˆDay-Frozen è®¾è®¡æ­£ç¡®ï¼‰ï¼Œ1 ä¸ªå·²ä¿®å¤ï¼ˆCategory ç¼–ç ï¼‰ |
| 2026-01-18 | **LightGBM å®éªŒå¤±è´¥** | RevCap@1%=44.97%ï¼ˆ-14.5%ï¼‰ï¼Œæ ‘æ¨¡å‹ä¸é€‚åˆç¨€ç–æ•°æ® |
| 2026-01-18 | **Three-Stage + raw Y å®éªŒ** | RevCap@1%=39.48%ï¼ˆåŠ£äº Directï¼‰ï¼Œç¡®è®¤ Direct + raw Y æœ€ä¼˜ |

---

# 5. ğŸ“ é™„å½•

## 5.1 æ•°å€¼æ±‡æ€»

| æ¨¡å‹ | Spearman | Top-1% Gift Rate | RevCap@1% | RevCap@5% | å¤‡æ³¨ |
|------|----------|-----------------|-----------|-----------|------|
| **Direct raw Y (Ridge)** | 0.0608 | 11.07% | **52.60%** | 64.72% | âœ… **å½“å‰æœ€ä¼˜** |
| Two-Stage raw Y | 0.0110 | 11.0% | 45.66% | - | |
| Direct log Y | 0.1061 | 24.05% | 37.73% | 59.84% | |
| Two-Stage log Y | 0.0997 | 23.6% | 32.01% | 54.62% | |
| **LightGBM raw Y** | 0.0504 | 11.05% | 44.97% | 52.80% | âŒ å¤±è´¥ |
| Whale-only raw Y | -0.0206 | 5.85% | 39.48% | 48.24% | âŒ å¤±è´¥ |
| Whale-only log Y | 0.0290 | 9.70% | 39.77% | 51.69% | |
| Oracle | - | - | 99.54% | - | |

> **å…³é”®ç»“è®º**ï¼š
> - Ridge alpha 0.001~1000 å¯¹ RevCap æ— å½±å“ï¼ˆÂ±0.02%ï¼‰ï¼ŒLinear æ¨¡å‹å·²è¾¾ç“¶é¢ˆ
> - LightGBM å¤±è´¥ï¼šæ ‘æ¨¡å‹ä¸é€‚åˆ 98.5% ä¸º 0 çš„ç¨€ç–æ•°æ®
> - Three-Stage/Whale-only å¤±è´¥ï¼šDirect + raw Y å·²éšå¼å­¦ä¼šæ‰¾ whale

## 5.2 è¿è¡Œè·¯å¾„

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `data_utils.py` | æ•°æ®å¤„ç†å…¥å£ |
| `features_cache/day_frozen_features_lw1h.parquet` | ç‰¹å¾ç¼“å­˜ |
| `results/raw_vs_log_comparison_20260118.json` | Raw vs Log ç»“æœ |

## 5.3 æ›´æ–°æ—¥å¿—

| æ—¥æœŸ | å˜æ›´ |
|------|------|
| 2026-01-18 | åˆ›å»º Day-Frozen ç‰ˆæœ¬ï¼Œå½’æ¡£æ‰€æœ‰æœ‰æ³„æ¼çš„æ—§å®éªŒ |
| 2026-01-18 | Raw Y vs Log Y å®éªŒï¼šRevCap@1% = 52.60%ï¼ˆ+39.6%ï¼‰ |
| 2026-01-18 | LightGBM å®éªŒï¼šRevCap@1% = 44.97%ï¼ˆ-14.5%ï¼‰ï¼Œå¤±è´¥ |
| 2026-01-18 | Three-Stage + raw Y å®éªŒï¼šRevCap@1% = 39.48%ï¼Œç¡®è®¤ Direct + raw Y æœ€ä¼˜ |
