# 🎯 实验配置对齐建议

> **Date:** 2026-01-18  
> **Author:** Viska Wei  
> **Purpose:** 统一后续实验配置，加快实验周期

---

## 📊 当前配置分析

### 当前实验配置（exp_binary_classification_20260118）

| 配置项 | 当前值 | 说明 |
|--------|--------|------|
| **数据量** | 4,909,515 samples | Train: 3,436,660 (70%), Val: 736,427 (15%), Test: 736,428 (15%) |
| **模型** | LightGBM (Tree-based) | 非 Linear/Logistic Regression |
| **特征版本** | Frozen | 严格无泄漏，只用 train 窗口统计 |
| **窗口时间** | 1h | `label_window_hours=1`（用户反馈：太长） |
| **训练时间** | 185s (Exp A) | 最快配置，12 轮收敛 |
| **特征数量** | 49 | Past-only 特征 |

### 问题诊断

1. **窗口时间 1h 过长**：用户反馈实验周期慢，1h 窗口导致数据量大、计算慢
2. **数据量过大**：~4.9M samples，训练时间虽短但特征工程耗时
3. **特征版本未统一**：部分实验用 frozen，部分用 rolling，口径不一致

---

## ✅ 推荐配置（快速迭代版）

### 核心原则

1. **缩短窗口时间**：从 1h → **15min**，减少数据量和计算量
2. **保持数据口径**：仍用 Click-level，保持任务定义一致
3. **统一特征版本**：默认用 **Frozen**（严格无泄漏，可复现）
4. **模型保持 LightGBM**：Tree-based，与历史一致
5. **采样策略**：可选择性下采样，加快特征工程

### 推荐配置表

| 配置项 | 推荐值 | 理由 | vs 当前 |
|--------|--------|------|---------|
| **数据量** | **~1.2M samples** | 15min 窗口，预计减少 75% | ↓ 75% |
| **采样策略** | **可选：下采样负样本至 1:20** | 若需更快，可采样（保持正样本全量） | 可选 |
| **模型** | **LightGBM (GBDT)** | 保持一致性，Tree-based | 不变 |
| **特征版本** | **Frozen** | 严格无泄漏，可复现，计算快 | 不变 |
| **窗口时间** | **15min** | 用户反馈 1h 太长，15min 更合理 | ↓ 75% |
| **训练参数** | **简化版**（见下） | 减少迭代轮数，加快训练 | 优化 |
| **特征数量** | **~49** | 保持现有特征体系 | 不变 |

### 训练参数配置（快速版）

```python
{
    'objective': 'binary',  # 或 'regression'
    'metric': 'auc',        # 或 'mae'
    'num_leaves': 31,       # 保持
    'learning_rate': 0.1,   # 从 0.05 → 0.1，加快收敛
    'feature_fraction': 0.8,
    'bagging_fraction': 0.8,
    'bagging_freq': 5,
    'num_boost_round': 200,  # 从 500 → 200，减少最大轮数
    'early_stopping_rounds': 20,  # 从 50 → 20，更早停止
    'seed': 42,
    'n_jobs': -1
}
```

**预期效果**：
- 训练时间：从 185s → **~60-80s**（减少 60%）
- 特征工程时间：从 ~10-15min → **~3-5min**（减少 70%）
- 总实验周期：从 ~20min → **~8-10min**（减少 50%）

---

## 📋 配置检查清单

### 实验前检查

- [ ] **窗口时间**：确认使用 15min（或 30min，不超过 1h）
- [ ] **特征版本**：确认使用 Frozen（除非明确测试 Rolling）
- [ ] **数据量**：确认样本数在合理范围（~1-2M）
- [ ] **模型类型**：确认使用 LightGBM（Tree-based）
- [ ] **训练参数**：确认使用快速版配置（learning_rate=0.1, max_rounds=200）

### 实验后记录

- [ ] 记录实际数据量（train/val/test samples）
- [ ] 记录实际训练时间
- [ ] 记录特征工程时间
- [ ] 记录最终性能指标

---

## 🔄 配置版本管理

### 配置命名

- **快速版（Fast）**：15min 窗口，简化参数，用于快速迭代
- **标准版（Standard）**：30min 窗口，标准参数，用于正式评估
- **完整版（Full）**：1h 窗口，完整参数，用于最终报告

### 使用场景

| 场景 | 推荐配置 | 说明 |
|------|---------|------|
| **快速验证假设** | Fast | 15min 窗口，简化参数 |
| **特征工程探索** | Fast | 快速测试新特征效果 |
| **模型对比实验** | Standard | 30min 窗口，保证结果可信 |
| **最终报告** | Full | 1h 窗口，完整评估 |

---

## 📊 预期性能变化

### 窗口时间对性能的影响（预估）

| 窗口时间 | 数据量 | 正样本率 | 预期 AUC | 预期 Prec@1% | 训练时间 |
|---------|--------|---------|---------|--------------|---------|
| **15min** | ~1.2M | ~1.2% | 0.58-0.60 | 18-20% | ~60s |
| **30min** | ~2.4M | ~1.3% | 0.59-0.61 | 19-21% | ~120s |
| **1h（当前）** | ~4.9M | ~1.5% | 0.61 | 19.24% | ~185s |

**结论**：15min 窗口预计性能下降 < 0.02 AUC，但训练时间减少 60%，**性价比高**。

---

## 🎯 下一步行动

1. **立即采用快速版配置**：所有新实验默认使用 15min 窗口 + 快速参数
2. **建立配置模板**：在 `scripts/` 下创建 `config_fast.py` 和 `config_standard.py`
3. **更新实验报告模板**：在 exp.md 模板中增加"实验配置"章节
4. **性能基准测试**：运行一次 15min vs 1h 的对比实验，验证性能差异

---

> **最后更新**: 2026-01-18  
> **状态**: ✅ 建议采用
